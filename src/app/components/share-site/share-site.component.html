<div mat-dialog-title class="title v-center d-flex">
  <h4 class="mb-0 font-weight-bold f-24">Share CRMGROW</h4>
  <i class="d-block i-icon i-close bgc-dark ml-auto" mat-dialog-close></i>
</div>

<mat-dialog-content>

  <div class="form-group contacts-form">
    <div class="v-center mb-1">
      <label class="mb-0">Referrals to share</label>
      <a
        class="label-search ml-auto f-2 td-none c-pointer"
        [class.hidden]="!labelSearchedContacts.length"
        (click)="openLabelContacts()"
        cdkOverlayOrigin
        #trigger="cdkOverlayOrigin"
        #teamTrigger>Insert Team Contacts</a>
    </div>
    <app-input-contacts
      [selectedContacts]="selectedContacts"
      [onlyFromSearch]="false"
      [chipType]="'inline'"
      [display]="'email'"
      [placeholder]="'Add Referrals'"
    >
    </app-input-contacts>
    <span class="invalid-feedback d-block f-2 mt-0" *ngIf="submitted && !selectedContacts.length">
      Please add referrals to share.
    </span>
  </div>

  <ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="trigger"
    [cdkConnectedOverlayOpen]="isOpen"
    [cdkConnectedOverlayPositions]="connectedPositions"
    (overlayOutsideClick)="closeOverlay($event)"
  >
    <div class="searched-contacts mt-0 bg-white">
      <div *ngIf="labelSearchedContacts.length" class="action mr-0 c-pointer" (click)="addAllLabelSearched()">
        <a>Select All</a>
      </div>
      <ng-container *ngFor="let contact of labelSearchedContacts; let i = index;">
        <div class="d-flex chip py-2" (click)="addContact(contact)">
          <div class="form-avatar rounded-circle bg-dark mr-3 mt-1">{{contact.avatarName}}</div>
          <div class="info">
            <div class="f-5 font-weight-bold">{{contact.name}}</div>
            <div class="f-2">{{contact['email'] || 'Undefined'}}</div>
          </div>
        </div>
      </ng-container>
    </div>
  </ng-template>

  <div class="form-group mt-3">
    <input class="form-control" placeholder="Email Subject" [(ngModel)]="email.subject"/>
    <span class="invalid-feedback d-block f-2 mt-0" *ngIf="submitted && !email.subject">
      Please input the subject.
    </span>
  </div>
  <div class="form-group">
    <div class="v-center label-group">
      <label class="theme-label">CONTENT</label>
      <span class="c-blue f-1 mb-1 ml-2 mr-1 font-weight-bold">Show shortcut tokens</span>
      <div ngbDropdown class="justify-content-end mb-1 field-actions button-more rounded">
        <a class="v-center justify-content-end c-pointer" ngbDropdownToggle>
          <i class="i-icon i-triangle-more bgc-blue" aria-hidden="true"></i>
        </a>
        <div ngbDropdownMenu class="button-more-container light">
          <div class="actions ml-auto">
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{user_name}')">Your Name</button>
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{contact_first_name}')">Contact Firstname</button>
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{user_email}')">Your Email</button>
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{user_phone}')">Your Phone</button>
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{contact_last_name}')">Contact Lastname</button>
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{contact_email}')">Contact Email</button>
            <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertEmailContentValue('{contact_phone}')">Contact Phone</button>
          </div>
        </div>
      </div>
    </div>
    <app-html-editor
        [(value)]="email.content"
        placeholder="Enter Text"
        required="true"
        [style]="{height: '200px'}"
        #emailEditor
        >
    </app-html-editor>
    <div class="mt-3">
      <label class="theme-label">Template</label>
      <app-input-template
        [type]="'email'"
        [placeholder]="'Search templates'"
        [(template)]="selectedTemplate"
        (templateChange)="selectTemplate($event)">
      </app-input-template>
    </div>
  </div>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button class="btn btn-white" mat-dialog-close>Close</button>
  <button class="btn btn-primary" (click)="share()" [class.loading]="sharing">Share</button>
</mat-dialog-actions>
