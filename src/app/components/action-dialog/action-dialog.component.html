<div mat-dialog-title class="title mx-0">
  <span *ngIf="stepIndex === 1">Select the action</span>
<!--  <span *ngIf="stepIndex === 2">Setting the {{ActivityName[type]}}</span>-->
  <ng-container *ngIf="isMaterialSetting(); else noMaterialTitle">
    <span *ngIf="stepIndex === 2">Choose media to email</span>
  </ng-container>
  <ng-template #noMaterialTitle>
    <span *ngIf="stepIndex === 2">Setting the {{ActivityName[type]}}</span>
  </ng-template>
</div>
<form #actionForm="ngForm" (ngSubmit)="submitted = true; actionForm.form.valid ? decideAction() : false"
  [class.was-validated]="submitted">
  <mat-dialog-content class="content-section" [class]="type">
    <div class="action-list" [class.enable]="stepIndex===1">
      <ul>
        <ng-container>
          <ng-container *ngFor="let action_type of ConditionActionTypes">
            <li *ngIf="action_type.type == conditionAction" class="action-type" (click)="decideCaseAction(action_type)">
              <img src="{{action_type.icon}}">
              <div class="action_type_desc">
                <h4>{{action_type.title}}</h4>
                <span>{{action_type.desc}}</span>
              </div>
            </li>
          </ng-container>
        </ng-container>
        <ng-container *ngFor="let action_type of DisplayActions">
          <li class="action-type" (click)="fillContent(action_type)" *ngIf="action_type.type !== 'update_follow_up'; else updateFollowUp">
            <img src="{{action_type.icon}}">
            <div class="action_type_desc">
              <h4>{{action_type.title}}</h4>
              <span>{{action_type.desc}}</span>
            </div>
          </li>
          <ng-template #updateFollowUp>
            <li class="action-type" (click)="fillContent(action_type)" *ngIf="data && data.follows && data.follows.length">
              <img src="{{action_type.icon}}">
              <div class="action_type_desc">
                <h4>{{action_type.title}}</h4>
                <span>{{action_type.desc}}</span>
              </div>
            </li>
          </ng-template>
        </ng-container>
      </ul>
    </div>
    <div class="action-setting mt-3" [class.enable]="stepIndex===2">
      <ng-container
        *ngIf="type == 'send_email_video' || type == 'send_text_video'
               || type == 'send_email_pdf' || type == 'send_text_pdf'
               || type == 'send_email_image' || type == 'send_text_image'
      ">
        <div class="template-container mr-lg-5 mr-md-3 mr-sm-0">
          <div class="form-group search-form">
            <div class="input-group-prepend">
              <i class="i-icon i-search d-block bgc-dark"></i>
            </div>
            <input type="text" class="form-control" name="search" placeholder="Search" aria-label="search" aria-describedby="search-addon" [(ngModel)]="searchStr" (ngModelChange)="filter()">
            <ng-container *ngIf="searchStr">
              <div class="cancel-action c-pointer" (click)="clearSearchStr()">
                <i class="i-icon i-close d-block bgc-dark"></i>
              </div>
            </ng-container>
          </div>
          <app-slide-tab [tabs]="tabs" [selected]="selectedTab" (onChange)="changeTab($event)" type="same">
          </app-slide-tab>
          <ng-container *ngIf="videosLoading && selectedTab.id == 'videos'">
            <div class="list-loading text-center">
              <div class="loader mt-5"></div>
              <h4 class="fw-600 mt-2">Loading videos...</h4>
            </div>
          </ng-container>
          <div class="empty-list" *ngIf="!videosLoading && selectedTab.id == 'videos' && videos.length == 0">
            <div class="object-icon v-center">
              <i class="i-icon i-template d-block bgc-dark"></i>
            </div>
            <h4 class="font-weight-bold mt-4 mb-3">
              There is no videos.
            </h4>
          </div>
          <ng-container *ngIf="selectedTab.label == 'VIDEO'">
            <div class="material-container mt-3">
              <ng-container *ngFor="let video of filterVideos">
                <div class="material-item" (click)="toggleVideo(video)" [class.active]="action['video'] == video">
                  <img class="confirm" src="../../../assets/img/confirm.svg" alt="check" *ngIf="action['video'] == video">
                  <div class="thumb-wrapper video-wrapper">
                    <img [src]="video.thumbnail" class="thumbnail" onerror="( this.src = './assets/img/video_thumb.jpg');"/>
                    <img [src]="video.preview" class="preview" onerror="( this.src = './assets/img/video_thumb.jpg');"/>
                  </div>
                  <div class="material-title f-1 font-weight-bold mt-3">
                    {{video.title}}
                  </div>
                  <div class="material-description f-1 mt-2">
                    {{video.description || '' | stripTags | shorten: 80: '...'}}
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>
          <ng-container *ngIf="selectedTab.label == 'PDF'">
            <ng-container *ngIf="pdfsLoading && selectedTab.id == 'pdfs'">
              <div class="list-loading text-center">
                <div class="loader mt-5"></div>
                <h4 class="fw-600 mt-2">Loading PDFs...</h4>
              </div>
            </ng-container>
            <div class="empty-list" *ngIf="!pdfsLoading && selectedTab.id == 'pdfs' && pdfs.length == 0">
              <div class="object-icon v-center">
                <i class="i-icon i-template d-block bgc-dark"></i>
              </div>
              <h4 class="font-weight-bold mt-4 mb-3">
                There is no PDFs.
              </h4>
            </div>
            <div class="material-container mt-3">
              <ng-container *ngFor="let pdf of filterPdfs">
                <div class="material-item" (click)="togglePdf(pdf)" [class.active]="action['pdf'] == pdf">
                  <img class="confirm" src="../../../assets/img/confirm.svg" alt="check" *ngIf="action['pdf'] == pdf">
                  <div class="thumb-wrapper">
                    <img class="thumbnail" src="{{pdf.thumbnail || pdf.preview}}" alt="{{pdf.title}}" onerror="( this.src = './assets/img/pdf_overlay.png' );" />
                  </div>
                  <div class="material-title f-1 font-weight-bold mt-3">
                    {{pdf.title}}
                  </div>
                  <div class="material-description f-1 mt-2">
                    {{pdf.description || '' | stripTags | shorten: 80: '...'}}
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>
          <ng-container *ngIf="selectedTab.label == 'IMAGE'">
            <ng-container *ngIf="imagesLoading && selectedTab.id == 'image'">
              <div class="list-loading text-center">
                <div class="loader mt-5"></div>
                <h4 class="fw-600 mt-2">Loading images...</h4>
              </div>
            </ng-container>
            <div class="empty-list" *ngIf="!imagesLoading && selectedTab.id == 'images' && images.length == 0">
              <div class="object-icon v-center">
                <i class="i-icon i-template d-block bgc-dark"></i>
              </div>
              <h4 class="font-weight-bold mt-4 mb-3">
                There is no images.
              </h4>
            </div>
            <div class="material-container mt-3">
              <ng-container *ngFor="let image of filterImages">
                <div class="material-item" (click)="toggleImage(image)" [class.active]="action['image'] == image">
                  <img class="confirm" src="../../../assets/img/confirm.svg" alt="check" *ngIf="action['image'] == image">
                  <div class="thumb-wrapper">
                    <img class="thumbnail" src="{{image.thumbnail || image.preview}}" alt="{{image.title}}" onerror="( this.src = './assets/img/image_overlay.png' );" />
                  </div>
                  <div class="material-title f-1 font-weight-bold mt-3">
                    {{image.title}}
                  </div>
                  <div class="material-description f-1 mt-2">
                    {{image.description || '' | stripTags | shorten: 80: '...'}}
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>
          <div class="c-red f-3 error mt-3">{{this.materialError}}</div>
        </div>
      </ng-container>
      <!--  *ngIf="!(data.action.condition && data.editFlag)" -->
      <div class="contents-container w-100 mt-lg-0 mt-md-0 mt-sm-3 mt-3">
        <ng-container
          *ngIf="!(type == 'follow_up' || type == 'update_follow_up' || type == 'note')">
          <div class="row">
            <div class="col-md-12">
              <div class="form-group has-feedback">
                <ng-container *ngIf="!data.conditionHandler; else conditionLimitTemplate">
                  <ng-container *ngIf="NoLimitActions.indexOf(type) === -1">
                    <label class="theme-label">TIME DELAY <span class="description">(DURATION SINCE PREVIOUS ACTION)</span></label>
                    <select class="form-control theme-control" [(ngModel)]="action['period']" name="period" #period="ngModel" [required]="type && type.indexOf('watched') === -1">
                      <option value="0">Immediately</option>
                      <option value="0.17">10 mins</option>
                      <option value="0.5">30 mins</option>
                      <option value="1">1 hour</option>
                      <option value="6">6 hours</option>
                      <option value="12">12 hours</option>
                      <option value="24">1 day</option>
                      <option value="48">2 days</option>
                      <option value="72">3 days</option>
                      <option value="168">1 week</option>
                      <option value="336">2 weeks</option>
                      <option value="custom_date">Custom Time Delay</option>
                    </select>
                    <span class="invalid-feedback"
                          *ngIf="period.errors && (period.touched || period.dirty || submitted) && submitted">
                    Period is required
                  </span>
                  </ng-container>
                </ng-container>
                <ng-template #conditionLimitTemplate>
                  <ng-container *ngIf="data.conditionHandler === 'trueCase'; else falseCaseTimeTemplate">
                    <ng-container *ngIf="NoLimitActions.indexOf(type) === -1">
                      <label class="theme-label">TIME DELAY <span class="description">(DURATION SINCE AFTER WATCHED)</span></label>
                      <select class="form-control theme-control" [(ngModel)]="action['period']" name="period" #period="ngModel" [required]="type && type.indexOf('watched') === -1">
                        <option value="0">Immediately</option>
                        <option value="0.17">10 mins</option>
                        <option value="0.5">30 mins</option>
                        <option value="1">1 hour</option>
                        <option value="6">6 hours</option>
                        <option value="12">12 hours</option>
                        <option value="24">1 day</option>
                        <option value="48">2 days</option>
                        <option value="72">3 days</option>
                        <option value="168">1 week</option>
                        <option value="336">2 weeks</option>
                        <option value="custom_date">Custom Time Delay</option>
                      </select>
                      <span class="invalid-feedback"
                            *ngIf="period.errors && (period.touched || period.dirty || submitted) && submitted">
                      Period is required
                    </span>
                    </ng-container>
                  </ng-container>
                  <ng-template #falseCaseTimeTemplate>
                    <label class="theme-label">
                      TIME DELAY <span class="description">(DURATION OF NO ACTION)</span>
                    </label>
                    <select class="form-control theme-control" [(ngModel)]="action['period']" name="period" #period="ngModel" [required]="type && type.indexOf('watched') === -1">
                      <option value="0">Immediately</option>
                      <option value="0.17">10 mins</option>
                      <option value="0.5">30 mins</option>
                      <option value="1">1 hour</option>
                      <option value="6">6 hours</option>
                      <option value="12">12 hours</option>
                      <option value="24">1 day</option>
                      <option value="48">2 days</option>
                      <option value="72">3 days</option>
                      <option value="168">1 week</option>
                      <option value="336">2 weeks</option>
                      <option value="custom_date">Custom Time Delay</option>
                    </select>
                    <span class="invalid-feedback"
                          *ngIf="period.errors && (period.touched || period.dirty || submitted) && submitted">
                    Period is required
                  </span>
                  </ng-template>
                </ng-template>
              </div>
            </div>
            <div class="col-md-12" *ngIf="action['period'] === 'custom_date'">
              <div class="form-group mb-0">
                <label for="plan_time_day" class="theme-label">CUSTOM TIME DELAY <span class="description">(IN DAYS)</span></label>
                <input type="number" step="1" class="form-control" name="planTimeDay" [required]="action.period == 'custom_date'" [(ngModel)]="plan_time['day']" />
              </div>
              <span class="error text-danger ml-2"
                    *ngIf="action.period=='custom_date' && !plan_time['day'] && !plan_time['hour'] && !plan_time['min'] && submitted">Plan time is required.</span>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type==='follow_up'">
          <div class="action-form">
            <div class="form-group">
              <label>type of the task</label>
              <div>
                <div class="task-types btn-group btn-group-toggle rounded" ngbRadioGroup name="type" #type="ngModel" [(ngModel)]="task.type">
                  <label class="btn px-2 rounded no-shadow" title="General" ngbButtonLabel>
                    <input type="radio" name="options" value="task" ngbButton>
                    <i class="i-icon i-task d-block bgc-dark"></i>
                  </label>
                  <label class="btn px-2 rounded no-shadow" title="Call" ngbButtonLabel>
                    <input type="radio" name="options" value="call" ngbButton>
                    <i class="i-icon i-phone d-block bgc-dark"></i>
                  </label>
                  <label class="btn px-2 rounded no-shadow" title="Meeting" ngbButtonLabel>
                    <input type="radio" name="options" value="meeting" ngbButton>
                    <i class="i-icon i-lunch d-block bgc-dark"></i>
                  </label>
                  <label class="btn px-2 rounded no-shadow" title="Email" ngbButtonLabel>
                    <input type="radio" name="options" value="email" ngbButton>
                    <i class="i-icon i-message d-block bgc-dark"></i>
                  </label>
                  <label class="btn px-2 rounded no-shadow" title="Media" ngbButtonLabel>
                    <input type="radio" name="options" value="material" ngbButton>
                    <i class="i-icon i-video d-block bgc-dark"></i>
                  </label>
                </div>
              </div>
            </div>
            <div class="form-group has-feedback"
                 [class.has-error]="followUpContent.errors && (followUpContent.touched || followUpContent.dirty|| submitted) && submitted">
              <label class="theme-label">FOLLOW UP NOTE <span class="description">(REMINDER TO YOURSELF)</span></label>
              <textarea [(ngModel)]="action.content" class="form-control" placeholder="Type of Follow up note" name="followUpContent"
                        #followUpContent="ngModel" rows="6" required></textarea>
              <span class="invalid-feedback"
                    *ngIf="followUpContent.errors && (followUpContent.dirty || followUpContent.touched || submitted) && submitted">Follow
              up content is required.</span>
            </div>
            <label class="theme-label">FOLLOW UP TIME</label>
            <div class="row">
              <div class="col-12">
                <div class="theme-radios">
                  <div class="theme-radio">
                    <input type="radio" class="custom-control-input" id="due_date_option" name="follow_due_option"
                           [(ngModel)]="followDueOption" #follow_due_option="ngModel" value="date">
                    <label class="custom-theme-label" for="due_date_option">Set Date</label>
                  </div>
                  <div class="theme-radio">
                    <input type="radio" class="custom-control-input" id="due_delay_option" name="follow_due_option"
                           [(ngModel)]="followDueOption" #follow_due_option="ngModel" value="delay">
                    <label class="custom-theme-label" for="due_delay_option">Set Duration</label>
                  </div>
                </div>
              </div>
              <div class="col-12 mt-3" *ngIf="followDueOption === 'date'; else followTimeDelay">
                <div class="row">
                  <div class="col-6">
                    <div class="form-group has-feedback calendar position-relative"
                         [class.has-error]="due_date.year == '' && due_date.month == '' && due_date.day == '' && submitted">
                      <div class="form-group">
                        <label class="theme-label">FOLLOW UP DATE</label>
                        <div class="v-center">
                          <app-date-input type="prepend" [(value)]="due_date" [minDate]="minDate"></app-date-input>
                        </div>
                        <span
                          class="invalid-error f-3 c-red"
                          *ngIf="due_date.year == '' && due_date.month == '' && due_date.day == '' && submitted"
                        >
                                Date is required
                              </span>
                      </div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-group has-feedback" [class.has-error]="!due_time && submitted">
                      <label class="theme-label">FOLLOW UP TIME</label>
                      <select class="form-control theme-control" [(ngModel)]="due_time" name="time" #time="ngModel"
                              [required]="followDueOption === 'date'" [disabled]="followDueOption !== 'date'">
                        <option value="" disabled>Due Time</option>
                        <option *ngFor="let time of times" value="{{time.id}}">{{time.text}}</option>
                      </select>
                      <span class="invalid-feedback"
                            *ngIf="time.errors && (time.touched||time.dirty||submitted)&&submitted">Due time is required.</span>
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #followTimeDelay>
                <div class="col-12 mt-2">
                  <div class="form-group has-feedback">
                    <label class="theme-label">TIME UNTIL FOLLOW UP IS DO <span class="description">(IN HOURS)</span></label>
                    <input type="number" class="form-control theme-control" [(ngModel)]="due_duration" name="duration" #duration="ngModel"
                           [required]="followDueOption === 'delay'" [disabled]="followDueOption !== 'delay'"
                           min="1" />
                    <span class="invalid-feedback"
                          *ngIf="duration.errors && (duration.touched||duration.dirty||submitted)&&submitted">Due time is
                    required.</span>
                  </div>
                </div>
              </ng-template>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type==='note'">
          <div class="action-form">
            <div class="form-group has-feedback mt-2"
                 [class.has-error]="note.errors && (note.touched || note.dirty|| submitted) && submitted">
              <label class="theme-label">NOTE CONTENT</label>
              <textarea [(ngModel)]="action.content" class="form-control" placeholder="Please type content for note." name="note"
                        #note="ngModel" rows="6" required></textarea>
              <span class="invalid-feedback"
                    *ngIf="note.errors && (note.dirty || note.touched || submitted) && submitted">Note
              content is required.</span>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type==='send_text_video' || type === 'send_text_pdf' || type === 'send_text_image'">
          <div class="action-form">
            <div class="form-group has-feedback"
                 [class.has-error]="content.errors && (content.touched || content.dirty|| submitted) && submitted">
              <ng-container *ngIf="type == 'send_email_video' || type == 'send_text_video'
                                   || type == 'send_email_pdf' || type == 'send_text_pdf'
                                   || type == 'send_email_image' || type == 'send_text_image'; else noMaterial">
                <div class="v-center label-group">
                  <label class="theme-label">CONTENT</label>
                  <div ngbDropdown class="justify-content-end field-actions button-more rounded">
                    <a class="v-center justify-content-end text-decoration-none c-pointer" ngbDropdownToggle>
                      <span class="c-blue f-1 ml-2 mr-1 font-weight-bold">Show shortcut tokens</span>
                      <i class="i-icon i-triangle-more bgc-blue" aria-hidden="true"></i>
                    </a>
                    <div ngbDropdownMenu class="button-more-container light">
                      <div class="actions ml-auto">
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{user_name}', smsContentField)">Your Name</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{user_email}', smsContentField)">Your Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{user_phone}', smsContentField)">Your Phone</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_first_name}', smsContentField)">Contact Firstname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_last_name}', smsContentField)">Contact Lastname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_email}', smsContentField)">Contact Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_phone}', smsContentField)">Contact Phone</button>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
              <ng-template #noMaterial>
                <label class="theme-label">CONTENT</label>
                <div class="d-flex flex-wrap field-actions mb-2">
                  <button type="button" class="btn btn-sm btn-white-gray font-weight-bold" (click)="insertSmsContentValue('{user_name}', smsContentField)">Your Name</button>
                  <button type="button" class="btn btn-sm btn-white-gray font-weight-bold" (click)="insertSmsContentValue('{user_email}', smsContentField)">Your Email</button>
                  <button type="button" class="btn btn-sm btn-white-gray font-weight-bold" (click)="insertSmsContentValue('{user_phone}', smsContentField)">Your Phone</button>
                  <div ngbDropdown class="d-flex justify-content-end button-more rounded">
                    <a class="v-center justify-content-end c-pointer" ngbDropdownToggle>
                      <i class="i-icon i-triangle-more bgc-blue" aria-hidden="true"></i>
                    </a>
                    <div ngbDropdownMenu class="button-more-container light">
                      <div class="actions ml-auto">
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_first_name}', smsContentField)">Contact Firstname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_last_name}', smsContentField)">Contact Lastname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_email}', smsContentField)">Contact Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSmsContentValue('{contact_phone}', smsContentField)">Contact Phone</button>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
              <textarea [(ngModel)]="action.content" class="form-control" placeholder="Please type in sms content."
                        name="content" #content="ngModel" rows="6" required #smsContentField (click)="getSmsContentCursor(smsContentField)"
                        (keyup)="getSmsContentCursor(smsContentField)"></textarea>
              <span class="error text-danger"
                    *ngIf="content.errors && (content.dirty || content.touched || submitted) && submitted">Content is
              required.</span>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'email' || type==='send_email_video' || type === 'send_email_pdf' || type === 'send_email_image'">
          <div class="action-form">
            <div class="form-group has-feedback"
                 [class.has-error]="subject.errors && (subject.touched || subject.dirty || submitted) && submitted">
              <ng-container *ngIf="type == 'send_email_video' || type == 'send_text_video'
                                   || type == 'send_email_pdf' || type == 'send_text_pdf'
                                   || type == 'send_email_image' || type == 'send_text_image'; else noMaterial">
                <div class="v-center label-group">
                  <label class="theme-label">SUBJECT</label>
                  <div ngbDropdown class="field-actions button-more rounded">
                    <a class="v-center justify-content-end text-decoration-none c-pointer" ngbDropdownToggle>
                      <span class="c-blue f-1 ml-2 mr-1 font-weight-bold">Show shortcut tokens</span>
                      <i class="i-icon i-triangle-more bgc-blue" aria-hidden="true"></i>
                    </a>
                    <div ngbDropdownMenu class="button-more-container light">
                      <div class="actions ml-auto">
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_name}', subjectField)">Your Name</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_first_name}', subjectField)">Contact Firstname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{material_title}', subjectField)">Material Title</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_email}', subjectField)">Your Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_phone}', subjectField)">Your Phone</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_phone}', subjectField)">Your Phone</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_last_name}', subjectField)">Contact Lastname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_email}', subjectField)">Contact Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_phone}', subjectField)">Contact Phone</button>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
              <ng-template #noMaterial>
                <label class="theme-label">SUBJECT</label>
                <div class="d-flex flex-wrap field-actions mb-2">
                  <button type="button" class="btn btn-sm btn-white-gray font-weight-bold" (click)="insertSubjectValue('{user_name}', subjectField)">Your Name</button>
                  <button type="button" class="btn btn-sm btn-white-gray font-weight-bold" (click)="insertSubjectValue('{contact_first_name}', subjectField)">Contact Firstname</button>
                  <button type="button" class="btn btn-sm btn-white-gray font-weight-bold" (click)="insertSubjectValue('{material_title}', subjectField)">Material Title</button>
                  <div ngbDropdown class="d-flex justify-content-end button-more rounded">
                    <a class="v-center justify-content-end c-pointer" ngbDropdownToggle>
                      <i class="i-icon i-triangle-more bgc-blue" aria-hidden="true"></i>
                    </a>
                    <div ngbDropdownMenu class="button-more-container light">
                      <div class="actions ml-auto">
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_email}', subjectField)">Your Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_phone}', subjectField)">Your Phone</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{user_phone}', subjectField)">Your Phone</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_last_name}', subjectField)">Contact Lastname</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_email}', subjectField)">Contact Email</button>
                        <button type="button" class="btn btn-sm btn-white-gray font-weight-bold dropdown-item" (click)="insertSubjectValue('{contact_phone}', subjectField)">Contact Phone</button>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-template>
              <input type="text" class="form-control" [(ngModel)]="action.subject" placeholder="Email Subject"
                     name="subject" #subject="ngModel" required #subjectField (click)="getSubjectCursorPost(subjectField)" (keyup)="getSubjectCursorPost(subjectField)"/>
              <span class="invalid-feedback"
                    *ngIf="subject.errors && (subject.dirty || subject.touched || submitted) && submitted">Subject is
              required.</span>
            </div>
            <div class="form-group has-feedback" [class.has-error]="!action.content && submitted">
              <ng-container *ngIf="type == 'send_email_video' || type == 'send_text_video'
                                   || type == 'send_email_pdf' || type == 'send_text_pdf'
                                   || type == 'send_email_image' || type == 'send_text_image'; else noContentMaterial">
                <div class="v-center label-group">
                  <label class="theme-label">CONTENT</label>
                </div>
              </ng-container>
              <ng-template #noContentMaterial>
                <label class="theme-label">CONTENT</label>
              </ng-template>
              <app-html-editor
                [(value)]="action.content"
                placeholder="Enter email content..."
                hasToken="true"
                hasTemplates="true"
                [templateSelectMethod]="'replace'"
                [style]="{height: '240px'}"
                #editor
              >
              </app-html-editor>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="type === 'update_contact'">
          <label class="theme-label mt-3">UPDATE TYPE</label>
          <div class="theme-radios">
            <div class="theme-radio">
              <input type="radio" class="custom-control-input" id="contact_label_update_option" name="contact_update_option"
                     [(ngModel)]="contactUpdateOption" #contact_update_option="ngModel" value="update_label" (ngModelChange)="removeError()">
              <label class="custom-theme-label" for="contact_label_update_option">Update label</label>
            </div>
            <div class="theme-radio">
              <input type="radio" class="custom-control-input" id="contact_tag_push_option" name="contact_update_option"
                     [(ngModel)]="contactUpdateOption" #contact_update_option="ngModel" value="push_tag" (ngModelChange)="removeError()">
              <label class="custom-theme-label" for="contact_tag_push_option">Insert tags</label>
            </div>
            <div class="theme-radio">
              <input type="radio" class="custom-control-input" id="contact_tag_pull_option" name="contact_update_option"
                     [(ngModel)]="contactUpdateOption" #contact_update_option="ngModel" value="pull_tag" (ngModelChange)="removeError()">
              <label class="custom-theme-label" for="contact_tag_pull_option">Remove tags</label>
            </div>
          </div>
          <ng-container [ngSwitch]="contactUpdateOption">
            <div *ngSwitchCase="'update_label'">
              <label class="theme-label mt-3">UPDATE DETAILS <span class="description">(NEW LABEL)</span></label>
              <app-label-select type="form" [value]="commandLabel" (valueChange)="changeCommandLabel($event)"></app-label-select>
            </div>
            <div *ngSwitchCase="'push_tag'">
              <label class="theme-label mt-3">UPDATE DETAILS <span class="description">(TAGS TO INSERT)</span></label>
              <div class="tag-input-wrapper br-default">
                <app-input-tag [selectedTags]="commandTags" [onlyFromSearch]="false"></app-input-tag>
              </div>
            </div>
            <div *ngSwitchCase="'pull_tag'">
              <label class="theme-label mt-3">UPDATE DETAILS <span class="description">(TAGS TO REMOVE)</span></label>
              <div class="tag-input-wrapper br-default">
                <app-input-tag [selectedTags]="commandTags" [onlyFromSearch]="true"></app-input-tag>
              </div>
            </div>
          </ng-container>
          <div class="text-danger error" *ngIf="error">{{error}}</div>
        </ng-container>
        <ng-container *ngIf="type === 'update_follow_up'">
          <div class="form-group">
            <label>type of the task</label>
            <div>
              <div class="task-types btn-group btn-group-toggle rounded" ngbRadioGroup name="type" #type="ngModel" [(ngModel)]="task.type">
                <label class="btn px-2 rounded no-shadow" title="General" ngbButtonLabel>
                  <input type="radio" name="options" value="task" ngbButton>
                  <i class="i-icon i-task d-block bgc-dark"></i>
                </label>
                <label class="btn px-2 rounded no-shadow" title="Call" ngbButtonLabel>
                  <input type="radio" name="options" value="call" ngbButton>
                  <i class="i-icon i-phone d-block bgc-dark"></i>
                </label>
                <label class="btn px-2 rounded no-shadow" title="Meeting" ngbButtonLabel>
                  <input type="radio" name="options" value="meeting" ngbButton>
                  <i class="i-icon i-lunch d-block bgc-dark"></i>
                </label>
                <label class="btn px-2 rounded no-shadow" title="Email" ngbButtonLabel>
                  <input type="radio" name="options" value="email" ngbButton>
                  <i class="i-icon i-message d-block bgc-dark"></i>
                </label>
                <label class="btn px-2 rounded no-shadow" title="Media" ngbButtonLabel>
                  <input type="radio" name="options" value="material" ngbButton>
                  <i class="i-icon i-video d-block bgc-dark"></i>
                </label>
              </div>
            </div>
          </div>
          <label class="theme-label mt-3">SELECT THE FOLLOW UP <span class="description">(CREATED IN PREVIOUS ACTIONS)</span></label>
          <mat-form-field appearance="fill" class="mat-custom-select">
            <mat-select [(value)]="selectedFollow" (selectionChange)="selectFollow($event)">
              <mat-select-trigger>
                <div class="template-item selected" *ngIf="selectedFollow">
                  <div class="name">{{selectedFollow.content}}</div>
                </div>
              </mat-select-trigger>
              <mat-option [value]="follow" *ngFor="let follow of data.follows" class="follow-item">
                <div class="content">{{follow.content}}</div>
                <div class="time">
                  <span class="label">{{follow.due_time ? 'REMINDER TIME' : 'DURATION FROM CREATED TO REMINDER' }}</span>
                  <span class="value" *ngIf="follow.due_time; else durationValueTemplate">{{ follow.due_time | date  }}</span>
                  <ng-template #durationValueTemplate><span class="value">{{follow.due_duration + ' Hours'}}</span></ng-template>
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
          <div class="c-red f-3 error" *ngIf="!selectedFollow && submitted">Follow up is required!</div>
          <ng-container *ngIf="selectedFollow">
            <div class="theme-radios">
              <div class="theme-radio">
                <input type="radio" class="custom-control-input" id="follow_up_update" name="follow_up_update_option"
                       [(ngModel)]="followUpdateOption" #follow_up_update_option="ngModel" value="update_follow_up" (ngModelChange)="removeError()">
                <label class="custom-theme-label" for="follow_up_update">Update Follow up</label>
              </div>
              <div class="theme-radio">
                <input type="radio" class="custom-control-input" id="follow_up_complete" name="follow_up_update_option"
                       [(ngModel)]="followUpdateOption" #follow_up_update_option="ngModel" value="complete_follow_up" (ngModelChange)="removeError()">
                <label class="custom-theme-label" for="follow_up_complete">Complete Follow up</label>
              </div>
            </div>

            <ng-container [ngSwitch]="followUpdateOption">
              <div *ngSwitchCase="'update_follow_up'">
                <div class="action-form">
                  <div class="form-group has-feedback mt-2"
                       [class.has-error]="followUpdateContent.errors && (followUpdateContent.touched || followUpdateContent.dirty|| submitted) && submitted">
                    <label class="theme-label">FOLLOW UP NOTE <span class="description">(REMINDER TO YOURSELF)</span></label>
                    <input type="text" class="form-control theme-control" placeholder="Type new content for this Follow up" [(ngModel)]="action.content"
                           name="followUpdateContent" #followUpdateContent="ngModel" autocomplete="off" required />
                    <span class="invalid-feedback"
                          *ngIf="followUpdateContent.errors && (followUpdateContent.dirty || followUpdateContent.touched || submitted) && submitted">Follow
                    up content is required.</span>
                  </div>
                  <label class="theme-label">FOLLOW UP TIME</label>
                  <div class="row">
                    <div class="col-12">
                      <select class="form-control theme-control" [(ngModel)]="updateFollowDueOption" name="updateFollowUpDueOption" #updateFollowUpDueOption="ngModel" required>
                        <option value="no_update">No Update</option>
                        <option value="update_due_date">Update Due Date</option>
                        <option value="update_due_duration">Update Due Duration</option>
                      </select>
                    </div>
                    <div class="col-12 mt-3" *ngIf="updateFollowDueOption === 'update_due_date'">
                      <div class="row">
                        <div class="col-6">
                          <div class="form-group has-feedback calendar position-relative"
                               [class.has-error]="update_due_date.year == '' && update_due_date.month == '' && update_due_date.day == '' && submitted">
                            <div class="form-group">
                              <label class="theme-label">FOLLOW UP DATE</label>
                              <div class="v-center">
                                <app-date-input type="prepend" [(value)]="update_due_date" [minDate]="minDate"></app-date-input>
                              </div>
                              <span
                                class="invalid-error f-3 font-weight-bold c-red"
                                *ngIf="update_due_date.year == '' && update_due_date.month == '' && update_due_date.day == '' && submitted"
                              >
                                Date is required
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group has-feedback" [class.has-error]="!due_time && submitted">
                            <label class="theme-label">FOLLOW UP TIME</label>
                            <select class="form-control theme-control" [(ngModel)]="update_due_time" name="time" #time="ngModel"
                                    [required]="followDueOption === 'date'">
                              <option value="" disabled>Due Time</option>
                              <option *ngFor="let time of times" value="{{time.id}}">{{time.text}}</option>
                            </select>
                            <span class="invalid-feedback"
                                  *ngIf="time.errors && (time.touched||time.dirty||submitted)&&submitted">Due time is required.</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 mt-2" *ngIf="updateFollowDueOption === 'update_due_duration'">
                      <div class="form-group has-feedback">
                        <label class="theme-label">TIME UNTIL FOLLOW UP IS DO <span class="description">(IN HOURS)</span></label>
                        <input type="number" class="form-control theme-control" [(ngModel)]="update_due_duration" name="duration" #duration="ngModel"
                               [required]="followDueOption === 'delay'" min="0" />
                        <span class="invalid-feedback"
                              *ngIf="duration.errors && (duration.touched||duration.dirty||submitted)&&submitted">Due time is
                        required.</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div *ngSwitchCase="'complete_follow_up'">
                <div class="action-guide">Complete the selected follow up.</div>
              </div>
            </ng-container>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end" class="v-center mx-0">
    <button class="btn c-blue ml-1 mr-0" type="button" mat-dialog-close>Close</button>
<!--    <button *ngIf="stepIndex === 2" class="btn btn-white-blue ml-1 mr-0" type="button"-->
<!--            (click)="prevStep()">Prev</button>-->
    <button class="btn btn-primary ml-1 mr-0" type="submit">Insert</button>
  </mat-dialog-actions>
</form>
