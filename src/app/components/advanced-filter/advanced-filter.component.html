<div class="p-4c panel">
  <div class="v-center mb-3">
    <h4 class="font-weight-bold mb-0 title">Advanced Filter</h4>
    <button class="v-center border-0 bgc-trans ml-auto" type="button" (click)="close()">
      <i class="d-block i-icon i-close bgc-dark"></i>
    </button>
  </div>
  <form #actionForm="ngForm" (ngSubmit)="actionForm.form.valid ? applyFilters() : false"
    [class.was-validated]="actionForm.submitted">
    <div class="form-group">
      <label>Saved Filters</label>
      <div class="v-center">
        <div class="flex-grow-1">
          <app-filter-input (onSelect)="changeCurrentFilter($event)" [filter]="currentFilterId"></app-filter-input>
        </div>
        <ng-container *ngIf="currentFilterId">
          <button type="button" class="btn btn-primary ml-2" (click)="updateFilters()">Update</button>
          <button type="button" class="btn btn-primary ml-2" (click)="removeFilters()">Remove</button>
        </ng-container>
      </div>
      <div class="my-3">
        <label>Keyword Search</label>
        <div class="form-group mb-0 search-string">
          <input type="text" class="form-control" [(ngModel)]="searchOption.str" placeholder="Type in keyword"
            name="global_search" #global_search="ngModel" (ngModelChange)="updateSearchStr($event)" />
          <div class="cancel-action" (click)="clearSearchStr()" *ngIf="searchOption.str">
            <i class="i-icon i-close d-block bgc-dark"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-5 mb-3 v-center justify-content-between">
      <div class="v-center form-group mb-0">
        <div class="v-center">
          <label class="mb-0">Material Activity</label>
        </div>
      </div>
      <div class="v-center">
        <div class="f-3 fw-600 c-dark">Include</div>
        <label class="custom-toggle mb-0 mx-2" placement="top">
          <input type="checkbox" [checked]="!searchOption.includeLabel" (change)="toggleInclude('label')" name="includeLabel">
          <span class="custom-toggle-slider rounded-circle"></span>
        </label>
        <div class="f-3 fw-600 c-dark">Exclude</div>
      </div>
    </div>
    <div class="checkbox-wrapper label-options my-3 w-100">
      <div class="custom-checkbox label-item" *ngFor="let item of labelService.labels$ | async"
        style="height: unset; line-height: unset;">
        <input type="checkbox" class="custom-control-input" id="label-{{item._id}}" name="label-{{item._id}}"
          (change)="toggleLabels(item._id)" [checked]="searchOption.labelCondition.indexOf(item._id) !== -1">
        <label class="custom-control-label d-flex" for="label-{{item._id}}">
          <i class="i-icon i-label d-block mr-2"
            [style.backgroundColor]="item.color === '#FFF' ? '#000' : item.color"></i>
          <span class="f-3 fw-600 mt-1">{{item.name}}</span>
        </label>
      </div>
    </div>

    <div class="checkbox-wrapper materials w-100 my-3">
      <div class="custom-checkbox material-action" *ngFor="let item of materialActions"
        style="height: unset; line-height: unset;">
        <input type="checkbox" class="custom-control-input" id="material-{{item._id}}" name="material-actions"
          (click)="selectMaterialAction(item.title)" [checked]="selectedMaterialActions == item.title">
        <label class="custom-control-label v-center" for="material-{{item._id}}">
          <div class="f-3 fw-600 material-action-title">{{item.title}}</div>
          <div class="count f-3 font-weight-bold c-white bgc-blue ml-2 mr-2 text-center rounded-circle" *ngIf="item.count">{{item.count}}</div>
          <button type="button"
            class="list f-1 font-weight-bold border border-primary rounded c-blue c-pointer bgc-white"
            [disabled]="selectedMaterialActions != item.title"
            (click)="selectMaterial()"
          >
            List
          </button>
        </label>
      </div>
    </div>

    <div class="form-group my-3">
      <label for="country_cc">country</label>
      <app-input-country [selectedCountries]="searchOption.countryCondition" (onSelect)="updateFilter()"></app-input-country>
    </div>
    <div class="form-group my-3">
      <label for="state">State</label>
      <app-input-state [selectedRegions]="searchOption.regionCondition" (onSelect)="updateFilter()"></app-input-state>
    </div>
    <div class="form-group my-3">
      <label for="city">City</label>
      <input type="text" class="form-control" [(ngModel)]="searchOption.cityCondition" (ngModelChange)="updateFilter()" placeholder="" id="city" name="city"
        #city="ngModel" />
    </div>
    <div class="form-group my-3">
      <label for="zipcode">ZipCode</label>
      <input type="text" class="form-control" [(ngModel)]="searchOption.zipcodeCondition" (ngModelChange)="updateFilter()" placeholder="" id="zipcode" name="zipcode"
        #zipcode="ngModel" />
    </div>

    <div class="my-3">
      <div class="d-flex align-items-end justify-content-between">
        <div class="form-group mb-0">
          <label for="city">Source</label>
        </div>
        <div class="v-center mb-2">
          <div class="f-3 fw-600 c-dark">Include</div>
          <label class="custom-toggle mb-0 mx-2" placement="top">
            <input type="checkbox" id="source_check" name="source_check" [checked]="!searchOption.includeSource"
              (change)="toggleInclude('source')">
            <span class="custom-toggle-slider rounded-circle"></span>
          </label>
          <div class="f-3 fw-600 c-dark">Exclude</div>
        </div>
      </div>
      <app-input-source [selectedTags]="searchOption.sourceCondition" [onlyFromSearch]="true" (onSelect)="updateFilter()"></app-input-source>
    </div>
    <div class="my-3">
      <div class="d-flex align-items-end justify-content-between">
        <div class="form-group mb-0">
          <label for="city">Company</label>
        </div>
        <div class="v-center mb-2">
          <div class="f-3 fw-600 c-dark">Include</div>
          <label class="custom-toggle mb-0 mx-2" placement="top">
            <input type="checkbox" id="company_check" name="company_check" [checked]="!searchOption.includeBrokerage"
              (change)="toggleInclude('brokerage')">
            <span class="custom-toggle-slider rounded-circle"></span>
          </label>
          <div class="f-3 fw-600 c-dark">Exclude</div>
        </div>
      </div>
      <app-input-company [selectedTags]="searchOption.brokerageCondition" [onlyFromSearch]="true" (onSelect)="updateFilter()"></app-input-company>
    </div>

    <div class="my-3">
      <div class="d-flex align-items-end justify-content-between">
        <div class="form-group mb-0">
          <label for="tag_check">Tag</label>
        </div>
        <div class="v-center mb-2">
          <div class="f-3 fw-600 c-dark">Include</div>
          <label class="custom-toggle mb-0 mx-2" placement="top">
            <input type="checkbox" id="tag_check" name="tag_check" [checked]="!searchOption.includeTag" (change)="toggleInclude('tag')">
            <span class="custom-toggle-slider rounded-circle"></span>
          </label>
          <div class="f-3 fw-600 c-dark">Exclude</div>
        </div>
      </div>
      <app-input-tag [selectedTags]="searchOption.tagsCondition" [onlyFromSearch]="true" (onSelect)="updateFilter()"></app-input-tag>
    </div>
    <div class="my-3">
      <div class="form-group mb-0">
        <label>Last Activity</label>
      </div>
      <div class="checkbox-wrapper">
        <div class="custom-checkbox material-action" *ngFor="let item of activities"
          style="height: unset; line-height: unset;">
          <ng-container *ngIf="item.title != 'Sent image' && item.title != 'Reviewed PDF' && item.title != 'Reviewed image'">
            <input type="checkbox" class="custom-control-input" id="activity-{{item._id}}" name="activity-{{item._id}}"
              (change)="toggleActivities(item.title)" [checked]="searchOption.activityCondition.indexOf(activityDefine[item.title]) !== -1">
            <label class="custom-control-label" for="activity-{{item._id}}">
              <div class="f-3 mt-1">{{item.title}}</div>
            </label>
          </ng-container>
          <ng-container *ngIf="item.title == 'Sent image'">
            <input type="checkbox" class="custom-control-input" id="activity-{{item._id}}" name="activity-{{item._id}}"
              (change)="toggleActivities(item.title)" [checked]="searchOption.lastMaterial.send_image.flag">
            <label class="custom-control-label" for="activity-{{item._id}}">
              <div class="f-3 mt-1">{{item.title}}</div>
            </label>
          </ng-container>
          <ng-container *ngIf="item.title == 'Reviewed PDF'">
            <input type="checkbox" class="custom-control-input" id="activity-{{item._id}}" name="activity-{{item._id}}"
              (change)="toggleActivities(item.title)" [checked]="searchOption.lastMaterial.watched_pdf.flag">
            <label class="custom-control-label" for="activity-{{item._id}}">
              <div class="f-3 mt-1">{{item.title}}</div>
            </label>
          </ng-container>
          <ng-container *ngIf="item.title == 'Reviewed image'">
            <input type="checkbox" class="custom-control-input" id="activity-{{item._id}}" name="activity-{{item._id}}"
              (change)="toggleActivities(item.title)" [checked]="searchOption.lastMaterial.watched_image.flag">
            <label class="custom-control-label" for="activity-{{item._id}}">
              <div class="f-3 mt-1">{{item.title}}</div>
            </label>
          </ng-container>
        </div>
      </div>
    </div>
    <div class="form-group my-3 pb-2">
      <label>Select Date</label>
      <div class="v-center">
        <app-date-input type="prepend" [clearable]="true" [(value)]="searchOption.activityStart" (valueChange)="updateFilter()"></app-date-input>
        <div class="mx-2">-</div>
        <app-date-input type="prepend" [clearable]="true" [(value)]="searchOption.activityEnd" (valueChange)="updateFilter()"></app-date-input>
      </div>
    </div>
    <div class="fixed-action-group mt-4 d-flex">
      <button type="button" class="btn btn-white font-weight-bold ml-auto" type="button" (click)="close()">Cancel</button>
      <button type="button" class="btn btn-white-blue font-weight-bold ml-2" (click)="clearAllFilters()">Clear All Filters</button>
      <ng-container *ngIf="!currentFilterId">
        <button type="button" class="btn btn-primary ml-2" (click)="saveFilters()">Save</button>
      </ng-container>
    </div>
  </form>
</div>
