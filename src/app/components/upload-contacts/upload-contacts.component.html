<div class="dialog-container">
  <div class="v-center justify-content-between mx-0">
    <ng-container *ngIf="step == 1">
      <div class="f-22 font-weight-bold c-black">Import Contacts</div>
    </ng-container>
    <ng-container *ngIf="step == 2">
      <div class="f-22 font-weight-bold c-black">Map columns</div>
    </ng-container>
    <ng-container *ngIf="step == 3">
      <div class="f-22 font-weight-bold c-black">
        Duplicates
        <span class="f-6 ml-5 c-red ml-5" *ngIf="isDuplicatedEmail()">
          Email is duplicated. Please merge duplicated emails.
        </span>
      </div>
    </ng-container>
    <ng-container *ngIf="step == 4">
      <div class="d-flex align-items-end">
        <div class="f-22 font-weight-bold c-black">
          Review {{selectedImportContactsCount()}} contacts to import
        </div>
<!--        <div class="f-6 ml-5 font-weight-bold">-->
<!--          <span class="mr-2" *ngIf="selectedImportContactsCount() > 0">-->
<!--            {{selectedImportContactsCount()}} selected /-->
<!--          </span>-->
<!--          {{contactsToUpload.length}} contact(s)-->
<!--        </div>-->
      </div>
    </ng-container>
    <ng-container *ngIf="step == 5">
      <ng-container *ngIf="checkingDuplicate">
        <div class="f-22 font-weight-bold c-black">Sit tight, we're importing your contacts</div>
      </ng-container>
      <ng-container *ngIf="!checkingDuplicate">
        <div class="f-22 font-weight-bold c-black">Checking duplicated contacts</div>
      </ng-container>
    </ng-container>
<!--    <button type="button" class="v-center border-0 bgc-trans close-button" mat-dialog-close>-->
<!--      <i class="i-icon i-close bgc-black ml-1" aria-hidden="true"></i>-->
<!--    </button>-->
  </div>
  <mat-dialog-content class="mt-3">
    <ng-container *ngIf="step == 1">
      <div class="row mx-1 my-2">
        <div class="col-12 text-center upload-container d-flex justify-content-center">
          <div class="upload-input-area v-center justify-content-center" [class.no-cvs]="!isCSVFile">
            <input type="file" accept=".csv" #file (change)="readFile($event)"/>
            <ng-container *ngIf="isCSVFile; else noneCSVFile">
              <div class="notification v-center">
                <i class="i-icon i-folder bgc-blue" aria-hidden="true"></i>
                <div class="f-3 c-blue font-weight-bold ml-3">{{fileName}}</div>
                <i class="i-icon i-close bgc-blue ml-3" aria-hidden="true" (click)="initImport()"></i>
              </div>
            </ng-container>
            <ng-template #noneCSVFile>
              <div class="notification w-100">
                <div class="f-3 font-weight-bold c-black">Upload your CSV. file</div>
                <i class="i-icon lg i-upload d-block bgc-black mt-3 ml-auto mr-auto"></i>
                <div class="description text-center f-1 mt-3 px-5">Drag and drop your CSV. file in the area or click to select it in directory</div>
              </div>
            </ng-template>
          </div>
          <div class="v-center c-blue font-weight-bold f-3 mt-5" *ngIf="isCSVFile">{{fileSize}}</div>
        </div>
        <div class="text-center px-5 mt-3 mx-auto w-100">
          <div class="f-3 c-black font-weight-bold">
            Need help getting started?
          </div>
          <a class="v-center download-button f-3 border-0 c-blue font-weight-bold text-decoration-none mt-3 mx-auto" href="../../../assets/csv_template.csv" download="csv_template.csv">
            <i class="i-icon sm i-download bgc-blue" aria-hidden="true"></i>
            <span class="ml-2">Download Template</span>
          </a>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="step == 2">
      <div class="f-5 font-weight-bold mb-3">Map columns in your file to contact properties.</div>
      <table class="table">
        <thead>
          <th class="matched pl-0">Matched</th>
          <th class="column-file">Column Header From File</th>
          <th class="preview">Preview Information</th>
          <th class="crmgrow-property">Crmgrow Property</th>
        </thead>
        <tbody>
          <tr *ngFor="let column of columns; let i = index">
            <td class="matched pl-0">
              <div class="v-center" *ngIf="updateColumn[column]" >
                <i class="i-icon i-round-check mr-2 round-check"></i>
              </div>
            </td>
            <td class="column-file">
              <div class="f-4 font-weight-bold">{{column}}</div>
            </td>
            <td class="preview">
              <div class="example-data">
                {{ lines && lines[0] && (lines[0][i] || '..') }}
              </div>
            </td>
            <td class="crmgrow-property">
              <div class="form-group mb-0">
                <mat-select [(ngModel)]="updateColumn[column]">
                  <mat-option value="">Select Property</mat-option>
                  <mat-option *ngFor="let field of fields" value="{{field.value}}">
                    <div class="f-3 c-black" [class.selected-option-text]="updateColumn[column] == field.value">{{field.label}}</div>
                  </mat-option>
                </mat-select>
<!--                <select class="form-control" [(ngModel)]="updateColumn[column]">-->
<!--                  <option value="">Select Property</option>-->
<!--                  <option *ngFor="let field of fields" value="{{field.value}}">{{field.label}}</option>-->
<!--                </select>-->
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-container>
    <ng-container *ngIf="step == 3">
      <div class="duplicate-wrapper pr-2">
        <div class="dups-container" *ngIf="sameContacts.length">
          <div class="f-5 font-weight-bold mb-3">
            There were <span class="f-8 c-blue">{{sameContacts.length}}</span> record duplicates found in your .csv file. Please merge or edit primary data.
          </div>
          <ng-container  *ngFor="let dupItem of sameContacts; let dupIndex = index;">
            <div class="merge-group-wrapper mb-3">
              <div class="table-wrapper">
                <table class="table duplicate-check-table mb-0">
                  <thead>
                  <tr>
                    <th class="check-cell sticky-check-col">&nbsp;</th>
                    <th>Type</th>
                    <ng-container *ngFor="let column of columns">
                      <th [class]="column" *ngIf="updateColumn[column]">
                        {{column}}
                      </th>
                    </ng-container>
                    <th class="actions sticky-action-col">&nbsp;</th>
                  </tr>
                  </thead>
                  <tbody>
                  <tr class="duplicate-row" *ngFor="let contact of dupItem; let row = index;">
                    <td class="check-cell sticky-check-col"
                        [class.last-field]="row == dupItem.length - 1 ? true : false"
                    >
                      <div class="custom-control custom-checkbox" *ngIf="dupItem.length > 1">
                        <input type="checkbox" class="custom-control-input" id="duplicate-{{contact.id}}"
                               [checked]="isSelectedMerge(dupIndex, contact.id)"
                               (change)="$event ? selectedMergeContacts[dupIndex].toggle(contact.id) : null"
                               [disabled]="isDisable(dupIndex, contact.id)">
                        <label class="custom-control-label"
                               for="duplicate-{{contact.id}}"></label>
                      </div>
                    </td>
                    <td>
                      <div class="f-3 c-blue font-weight-bold">{{isContact(contact) ? 'Contact' : 'CSV'}}</div>
                    </td>
                    <ng-container *ngFor="let column of columns; let i = index;">
                      <td class="{{column}} f-3 font-weight-bold last-row"
                          *ngIf="updateColumn[column]"
                      >
                        <div [class]="column" [class.c-red]="checkDuplicateColumn(dupIndex, contact, column)">
                          {{isSelectableColumn(updateColumn[column]) ?
                          (selectableContent(column, contact) || '' | stripTags | shorten: 80: '...') :
                          (contact[updateColumn[column]] || '' | stripTags | shorten: 80: '...')}}
                        </div>
                      </td>
                    </ng-container>
                    <td class="actions sticky-action-col"
                        [class.last-field]="row == dupItem.length - 1 ? true : false"
                    >
                      <div class="v-center" *ngIf="!isContact(contact)">
                        <button type="button" class="v-center border-0 bgc-trans" (click)="editContact(contact.id)">
                          <i class="i-icon i-edit bgc-black" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="v-center border-0 bgc-trans ml-2" (click)="removeContact(contact.id, dupIndex)">
                          <i class="i-icon i-trash bgc-black" aria-hidden="true"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="v-center p-2">
                <div class="duplicate-error f-1 font-weight-bold c-red"
                      *ngIf="duplicateItems[dupIndex]">
                  EMAIL is duplicated. Please merge duplicated emails.
                </div>
                <div class="v-center ml-auto">
                  <button type="button"
                    class="btn btn-primary btn-sm f-3 font-weight-bold px-3"
                    (click)="merge(dupIndex)"
                    [disabled]="this.selectedMergeContacts[dupIndex].selected.length < 2"
                  >
                    Merge
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="step == 4">
      <div class="review-container">
        <table class="table review-table">
          <thead>
          <tr>
            <th class="check-cell border-top-0">
              <div class="custom-control custom-checkbox" (click)="selectAllContacts()">
                <input type="checkbox" class="custom-control-input" id="select_import_contacts" (change)="selectAllContacts()" [checked]="isSelectedContacts()">
                <label class="custom-control-label" for="select_import_contacts"></label>
              </div>
            </th>
            <ng-container *ngFor="let column of columns">
              <th *ngIf="updateColumn[column]">
                {{column}}
              </th>
            </ng-container>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let record of contactsToUpload; let row = index;">
            <td class="check-cell">
              <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input" id="record-{{record.id}}" (change)="selectedImportContacts.toggle(record.id)" [checked]="selectedImportContacts.isSelected(record.id)">
                <label class="custom-control-label" for="record-{{record.id}}"></label>
              </div>
            </td>
            <ng-container *ngFor="let column of columns; let i = index;">
              <td *ngIf="updateColumn[column]"
                  class="{{updateColumn[column]}}-cell f-3 font-weight-bold last-row"
              >
                <div [class]="column">
                  {{isSelectableColumn(updateColumn[column]) ?
                  (selectableContent(column, record) || '' | stripTags | shorten: 80: '...') :
                  (record[updateColumn[column]] || '' | stripTags | shorten: 80: '...')}}
                </div>
              </td>
            </ng-container>
          </tr>
          </tbody>
        </table>
      </div>
      <div class="f-3 c-red mt-2"
           *ngIf="!selectedImportContactsCount()">
        Please select at least on of contacts.
      </div>
    </ng-container>
    <ng-container *ngIf="step == 5">
      <div class="my-3" *ngIf="!checkingDuplicate">
        <mat-progress-bar class="custom-progress" [value]="uploadPercent"></mat-progress-bar>
        <div class="v-center justify-content-between w-100 mt-2">
          <div class="f-3 font-weight-bold">{{uploadSubTitle}}</div>
          <div class="f-3 font-weight-bold">{{uploadPercent}}%</div>
        </div>
      </div>
<!--      <div class="v-center justify-content-center" *ngIf="!checkingDuplicate">-->
<!--        <div class="upload-progress-wrapper">-->
<!--          <circle-progress-->
<!--            [percent]=uploadPercent-->
<!--            [radius]="100"-->
<!--            [outerStrokeWidth]="16"-->
<!--            [innerStrokeWidth]="8"-->
<!--            [outerStrokeColor]="'#78C000'"-->
<!--            [innerStrokeColor]="'#C7E596'"-->
<!--            [backgroundOpacity]="0"-->
<!--            [titleColor]="'#0000ff'"-->
<!--            [titleFontSize]="40"-->
<!--            [subtitleFontSize]="14"-->
<!--            [subtitle]=uploadSubTitle-->
<!--            [subtitleColor]="'#000000'"-->
<!--            [animation]="true"-->
<!--            [animationDuration]="0"-->
<!--          ></circle-progress>-->
<!--          <img class="glass-img" src="../../assets/img/hourglass.gif">-->
<!--        </div>-->
<!--      </div>-->
      <div class="my-3 text-center" *ngIf="checkingDuplicate">
        <div class="loader mt-2"></div>
        <h4 class="f-5 font-weight-bold mt-2">Checking duplicate contacts.</h4>
      </div>
      <div class="attention v-center justify-content-center py-2">
        <img class="attention-img" src="../../assets/img/warning.png">
        <div class="f-4 font-weight-bold c-black ml-3">
          Don't close this tab while uploading contacts.
        </div>
      </div>
    </ng-container>
  </mat-dialog-content>
  <mat-dialog-actions>
    <ng-container *ngIf="step == 1">
      <div class="d-flex justify-content-end w-100">
        <button class="btn btn-white c-blue font-weight-bold" type="button" (click)="close()">Cancel</button>
        <button class="btn btn-primary" type="button" (click)="selectField()">Next</button>
      </div>
    </ng-container>
    <ng-container *ngIf="step == 2">
      <div class="d-flex justify-content-between w-100">
        <button type="button" class="v-center btn btn-white-blue" (click)="back()">
          <i class="i-icon i-back sm bgc-blue ml-1" aria-hidden="true"></i>
          <span class="ml-2">Back</span>
        </button>
        <div class="d-flex">
          <button class="btn btn-white c-blue font-weight-bold" type="button" (click)="close()">Cancel</button>
          <button class="btn btn-primary" type="button" (click)="review()">Next</button>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="step == 3">
      <div class="d-flex justify-content-between w-100">
        <button type="button" class="v-center btn btn-white-blue"
            [disabled]="failedData.length"
            (click)="back()">
          <i class="i-icon i-back sm bgc-blue ml-1" aria-hidden="true"></i>
          <span class="ml-2">Back</span>
        </button>
        <div class="d-flex">
          <button class="btn btn-white c-blue font-weight-bold" type="button" (click)="close()">Cancel</button>
          <button class="btn btn-primary" type="button" (click)="goToReview()" [class.loading]="uploading">{{firstImport ? 'Review' : 'Import'}}</button>
        </div>
      </div>
    </ng-container>
    <ng-container *ngIf="step == 4">
      <div class="d-flex justify-content-between w-100">
        <button type="button" class="v-center btn btn-white-blue" (click)="back()">
          <i class="i-icon i-back sm bgc-blue ml-1" aria-hidden="true"></i>
          <span class="ml-2">Back</span>
        </button>
        <div class="d-flex">
          <button class="btn btn-white c-blue font-weight-bold" type="button" (click)="close()">Cancel</button>
          <button class="btn btn-primary" (click)="upload()" [class.loading]="uploading">Import {{selectedImportContactsCount()}} contact(s)</button>
        </div>
      </div>
    </ng-container>
  </mat-dialog-actions>
</div>

