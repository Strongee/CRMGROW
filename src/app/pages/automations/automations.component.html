<div class="page-content">
  <div class="my-2">
    <div class="d-flex justify-content-between">
      <h6 class="f-8 ls-2 font-weight-bold text-uppercase my-2">Automations</h6>
      <a class="btn btn-primary shadow py-2 v-center mb-2 border-0" [routerLink]="['/autoflow/new']">
        <i class="i-icon i-plus bg-white d-block sm mr-2"></i>
        <span class="fw-600 f-3">Create automation</span>
      </a>
    </div>
  </div>
  <div class="my-3 position-relative">
    <ng-container *ngIf="(automationService.automations$ | async).length; else emptyListTemplate">
      <div class="updating-status" *ngIf="(automationService.loading$ | async) === STATUS.REQUEST">
        LOADING
      </div>
      <table class="table automation-table">
        <thead>
          <th class="title">Title</th>
          <th class="auth">Owner</th>
          <th class="action-count">Actions</th>
          <th class="contacts">Contacts</th>
          <th class="created">Created</th>
          <th class="actions"></th>
        </thead>
        <tbody>
          <tr *ngFor="let automation of automationService.automations$ | async | paginate: {itemsPerPage: 10, currentPage: page, id: 'automationTable', total: (automationService.automations$ | async).length}">
            <td class="title">
              <div class="f-3 font-weight-bold">{{automation.title}}</div>
            </td>
            <td class="auth">
              <div class="role" [class.admin]="automation.role == 'admin'" [class.team]="automation.role === 'team' && automation.user === userId" [class.shared]="automation.role === 'team' && automation.user !== userId"></div>
            </td>
            <td class="action-count">
              <div class="f-3">{{automation.automations && automation.automations.length}}</div>
            </td>
            <td class="contacts">
              <div class="f-3">{{automation.contacts.length}}</div>
            </td>
            <td class="created">
              <div class="f-3">{{automation.created_at | date: 'dd/MM/yyyy'}}</div>
            </td>
            <td class="actions">
              <div class="v-center justify-content-end">
                <button type="button" class="btn btn-white f-3 font-weight-bold" (click)="assignAutomation($event, automation)">
                  Assign
                </button>
                <ng-container *ngIf="automation.role != 'admin' && automation.user == userId; else noneEditable">
                  <div class="icon-button v-center justify-content-center ml-3" (click)="openAutomation($event, automation)">
                    <i class="i-icon bgc-black i-edit"></i>
                  </div>
                </ng-container>
                <ng-template #noneEditable>
                  <div class="icon-button v-center justify-content-center ml-3">
                    <i class="i-icon bgc-white i-edit"></i>
                  </div>
                </ng-template>
                <div class="icon-button v-center justify-content-center ml-3">
                  <i class="i-icon bgc-black i-triangle-up"></i>
                </div>
                <div class="icon-button v-center justify-content-center ml-3" (click)="duplicate($event, automation)">
                  <i class="i-icon bgc-black i-duplicate"></i>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="d-flex justify-content-center align-items-center mt-4">
        <div class="ml-3 pagination-wrapper">
          <pagination-controls (pageChange)="page = $event" id="automationTable" maxSize="5" previousLabel=""
                               nextLabel=""></pagination-controls>
        </div>
      </div>
    </ng-container>
    <ng-template #emptyListTemplate>
      <ng-container [ngSwitch]="(automationService.loading$ | async)">
        <div class="empty-list" *ngSwitchCase="STATUS.SUCCESS">
          <div class="object-icon v-center">
            <i class="i-icon i-automation d-block bgc-dark"></i>
          </div>
          <h4 class="font-weight-bold mt-4 mb-3">
            There is no automations.
          </h4>
          <p class="mb-4">Please create automation to recruite automatically.</p>
          <a class="btn btn-primary" [routerLink]="['/autoflow/new']">
            <span class="font-weight-bold f-3">Create Automation</span>
          </a>
        </div>
        <div class="list-loading text-center" *ngSwitchCase="STATUS.REQUEST">
          <div class="loader mt-5 lg"></div>
          <h4 class="fw-600 mt-2">Loading automations for auto-recruiting...</h4>
        </div>
      </ng-container>
    </ng-template>
  </div>
</div>
