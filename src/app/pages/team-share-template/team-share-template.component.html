<div class="page-content">
  <div class="">
    <div class="v-center">
      <div class="form-group mb-0 search-form">
        <div class="input-group-prepend">
          <i class="i-icon i-search d-block bgc-dark"></i>
        </div>
        <input type="text" class="form-control" placeholder="Search" aria-label="search" aria-describedby="search-addon" [(ngModel)]="searchStr" (ngModelChange)="changeSearchStr()" [class.disabled]="(templatesService.loading$ | async) === STATUS.REQUEST">
        <ng-container *ngIf="searchStr">
          <div class="cancel-action c-pointer" (click)="clearSearchStr()">
            <i class="i-icon i-close d-block bgc-dark"></i>
          </div>
        </ng-container>
      </div>
    </div>
    <div class="my-3 position-relative">
      <ng-container *ngIf="templates.length">
        <table class="w-100 page-table"
           mat-table
           multiTemplateDataRows
           [dataSource]="filteredResult | paginate: {itemsPerPage: 8, currentPage: page, id: 'templateTable', total: filteredResult.length}"
        >
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef class="title">Title</th>
            <td mat-cell *matCellDef="let template" class="title">
              <a [routerLink]="['/templates/' + template._id]" class="td-none"><span class="f-3 font-weight-bold">{{template.title}}</span></a>
            </td>
          </ng-container>
          <ng-container matColumnDef="owner">
            <th mat-header-cell *matHeaderCellDef class="auth">Owner</th>
            <td mat-cell *matCellDef="let template" class="auth">
              <div class="role" [class.admin]="template.role == 'admin'" [class.team]="template.role === 'team' && template.user === userId" [class.shared]="template.role === 'team' && template.user !== userId"></div>
            </td>
          </ng-container>
          <ng-container matColumnDef="template-content">
            <th mat-header-cell *matHeaderCellDef class="template-content">Template</th>
            <td mat-cell *matCellDef="let template" class="template-content">
              <h5 class="font-weight-bold f-5 c-black mb-1">{{template.subject | stripTags | shorten: 40: '...'}}</h5>
              <span [innerHTML]="template.content | stripTags | shorten: 80: '...'"></span>
            </td>
          </ng-container>
          <ng-container matColumnDef="template-type">
            <th mat-header-cell *matHeaderCellDef class="template-type">Type</th>
            <td mat-cell *matCellDef="let template" class="template-type">
              <div class="v-center">
                <ng-container *ngIf="template.type=='text'; else emailType">
                  <i class="i-icon bgc-dark i-phone mr-2"></i>
                  <span class="f-4 menu-label font-weight-bold ml-1">{{template.type}}</span>
                </ng-container>
                <ng-template #emailType>
                  <i class="i-icon bgc-dark i-message mr-2"></i>
                  <span class="f-4 menu-label font-weight-bold ml-1">Email</span>
                </ng-template>
              </div>
            </td>
          </ng-container>
          <ng-container matColumnDef="template-action">
            <th mat-header-cell *matHeaderCellDef class="template-action"></th>
            <td mat-cell *matCellDef="let template" class="template-action">
              <div class="v-center justify-content-end">
                <ng-container *ngIf="template.role != 'admin' && template.user == userId">
                  <div class="icon-button v-center justify-content-center" (click)="openTemplate(template)" [class.disabled]="template.role == 'admin'">
                    <i class="i-icon bgc-dark i-edit"></i>
                  </div>
                </ng-container>
              </div>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="DISPLAY_COLUMNS"></tr>
          <tr mat-row *matRowDef="let element; columns: DISPLAY_COLUMNS;"></tr>
        </table>
        <div class="d-flex justify-content-center align-items-center my-2 py-3 table-control mode-1">
          <div class="ml-3 pagination-wrapper">
            <pagination-controls (pageChange)="page = $event" id="templateTable" maxSize="5" previousLabel=""
                                 nextLabel=""></pagination-controls>
          </div>
        </div>
      </ng-container>
    </div>
  </div>
</div>
