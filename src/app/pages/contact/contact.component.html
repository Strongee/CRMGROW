<div class="page-content pt-0">
  <div class="contact-panel d-flex">
    <div class="contact-info-panel pr-3">
      <div class="v-center op-56 c-pointer mb-4 mt-3 back-menu" (click)="goToBack()">
        <i class="d-block i-icon i-triangle-left bgc-dark mr-2"></i>
        <span class="f-5 font-weight-bold">Back {{getPrevPage()}}</span>
      </div>
      <div class="contact-main d-flex">
        <div class="contact-avatar lg font-weight-bold">
          {{contact.avatarName}}
        </div>
        <div class="contact-main-info ml-3">
          <!-- <div class="f-20 font-weight-bold text-overflow-wrap">{{contact.fullName}}</div> -->
          <div>
            <form
              #nameForm="ngForm"
              class="form-group mb-0 flex-grow-1 mr-3 name-editor"
              (keyup)="checkBlurName($event)"
              [class.d-none]="!nameEditable"
              [class.loading]="saving"
            >
              <input
                class="form-control first-name-input mr-1"
                [(ngModel)]="contactFirstName"
                (focus)="focusNameField('firstName')"
                name="firstname"
                (blur)="checkNameFields('firstName')"
                #firstname="ngModel"
                required
                [disabled]="saving"
              />
              <input
                class="form-control last-name-input"
                [(ngModel)]="contactLastName"
                (focus)="focusNameField('lastName')"
                (blur)="checkNameFields('lastName')"
                name="lastname"
                #lastname="ngModel"
                [disabled]="saving"
              />
            </form>
            <div class="f-20 font-weight-bold text-overflow-wrap" (click)="focusName()" [class.d-none]="nameEditable">
              {{contact.fullName}}
            </div>
          </div>
          <div class="f-3 op-40">{{contact.last_activity_time | date :'MM/dd/yyyy'}}</div>
        </div>
        <div ngbDropdown class="ml-auto button-more p-0">
          <div class="v-center btn btn-blue" ngbDropdownToggle>
            <span class="f-6 font-weight-bold text-white c-pointer px-2">
              Actions
            </span>
            <i class="d-block i-icon i-triangle-down bgc-white ml-2"></i>
          </div>
          <div ngbDropdownMenu class="light action-menu">
            <button class="border-0 c-dark dropdown-item" (click)="openGroupCallDlg()">
              <span class="ml-1 f-3 font-weight-bold">Create group call</span>
            </button>
            <button class="border-0 c-dark dropdown-item"(click)="openAppointmentDlg()">
              <span class="ml-1 f-3 font-weight-bold">Create appointment</span>
            </button>
            <hr class="my-1">
            <button class="border-0 c-dark dropdown-item" (click)="openSendEmail()">
              <span class="ml-1 f-3 font-weight-bold">Send email</span>
            </button>
            <button class="border-0 c-dark dropdown-item" (click)="openSendText()">
              <span class="ml-1 f-3 font-weight-bold">Send text</span>
            </button>
            <button class="border-0 c-dark dropdown-item" (click)="openTaskDlg()">
              <span class="ml-1 f-3 font-weight-bold">Add task</span>
            </button>
            <button class="border-0 c-dark dropdown-item" (click)="openNoteDlg()">
              <span class="ml-1 f-3 font-weight-bold">Add note</span>
            </button>
            <hr class="my-1">
            <button class="border-0 c-dark dropdown-item" (click)="openMergeContactDlg()">
              <span class="ml-1 f-3 font-weight-bold">Merge</span>
            </button>
            <button class="border-0 c-dark dropdown-item" (click)="openShareContactDlg()">
              <span class="ml-1 f-3 font-weight-bold">Share contact</span>
            </button>
            <hr class="my-1">
            <button class="border-0 c-dark dropdown-item" (click)="deleteContact()">
              <span class="ml-1 f-3 font-weight-bold c-red">Delete</span>
            </button>
          </div>
        </div>
      </div>
      <div class="my-3 py-2">
        <app-label-select [value]="contact.label" type="form" (valueChange)="changeLabel($event)"></app-label-select>
      </div>
      <mat-accordion multi class="general-panels">
        <!-- Begin Contact Detail -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle [expanded]="mainPanel">
          <mat-expansion-panel-header (click)="mainPanel = !mainPanel">
            <mat-panel-title>
              <div class="v-center w-100">
                <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                <span class="f-6 font-weight-bold ml-2">Contact details</span>
                <button class="btn border-0 border-primary f-2 font-weight-bold c-dark op-28 ml-auto btn-sm v-center" (click)="editContacts('main')">
                  <i class="i-icon i-edit d-block bgc-dark sm mr-1"></i>
                  <span>Edit</span>
                </button>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="contact-detail">
            <div class="v-center py-1">
              <i class="i-icon i-contact-phone bgc-dark mr-2"></i>
              <span class="f-6">{{contact.cell_phone}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-message bgc-dark mr-2"></i>
              <span class="f-6">{{contact.email}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-contact-location bgc-dark mr-2"></i>
              <span class="f-6">{{contact.fullAddress}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-webpage bgc-dark mr-2"></i>
              <span class="f-6">{{contact.website}}</span>
            </div>
          </div>
        </mat-expansion-panel>
        <!-- End Contact Detail -->

        <!-- Begin Contact Secondary Information -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle [expanded]="secondPanel">
          <mat-expansion-panel-header (click)="secondPanel = !secondPanel">
            <mat-panel-title>
              <div class="v-center w-100">
                <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                <span class="f-6 font-weight-bold ml-2">Secondary contacts</span>
                <button class="btn border-0 border-primary f-2 font-weight-bold c-dark op-28 ml-auto btn-sm v-center" (click)="editContacts('second')">
                  <i class="i-icon i-edit d-block bgc-dark sm mr-1"></i>
                  <span>Edit</span>
                </button>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="contact-detail">
            <div class="v-center py-1">
              <i class="i-icon i-contact-phone bgc-dark mr-2"></i>
              <span class="f-6">{{contact.secondary_phone}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-message bgc-dark mr-2"></i>
              <span class="f-6">{{contact.secondary_email}}</span>
            </div>
          </div>
          <div class="contact-secondary"></div>
        </mat-expansion-panel>
        <!-- End Contact Secondary Information -->

        <!-- Begin Contact Additional Information -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle [expanded]="additionalPanel">
          <mat-expansion-panel-header (click)="additionalPanel = !additionalPanel">
            <mat-panel-title>
              <div class="v-center w-100">
                <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                <span class="f-6 font-weight-bold ml-2">Additional information</span>
                <button class="btn border-0 border-primary f-2 font-weight-bold c-dark op-28 ml-auto btn-sm v-center" (click)="editAdditional()">
                  <i class="i-icon i-edit d-block bgc-dark sm mr-1"></i>
                  <span>Edit</span>
                </button>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="contact-additional">
            <div class="v-center py-2">
              <span class="f-6 fw-600 op-40 info-title">Source</span>
              <span class="f-6">{{contact.source}}</span>
            </div>
            <div class="v-center py-2">
              <span class="f-6 fw-600 op-40 info-title">Current Company</span>
              <span class="f-6">{{contact.brokerage}}</span>
            </div>
            <div class="d-flex py-2">
              <span class="f-6 fw-600 op-40 info-title">Tags</span>
              <div class="f-3 tags-wrapper flex-grow-1">
                <!-- <app-input-tag [selectedTags]="contact.tags"></app-input-tag> -->
                <span *ngFor="let tag of contact.tags" class="tag-el">
                  {{tag}}
                </span>
              </div>
            </div>
            <ng-container *ngFor="let item of lead_fields">
              <div class="d-flex py-2">
                <span class="f-6 fw-600 op-40 info-title">{{item}}</span>
                <span class="f-6">{{contact.additional_field ? contact.additional_field[item] : ''}}</span>
              </div>
            </ng-container>
            <ng-container *ngFor="let item of contact.additional_field | keyvalue">
              <div class="d-flex py-2" *ngIf="lead_fields.indexOf(item.key) === -1">
                <span class="f-6 fw-600 op-40 info-title">{{item.key}}</span>
                <span class="f-6">{{item.value}}</span>
              </div>
            </ng-container>
            <div class="mt-2">
              <a class="c-blue fw-600 td-none c-pointer" (click)="addAdditionalFields()">Edit additional fields</a>
            </div>
          </div>
        </mat-expansion-panel>
        <!-- End Contact Additional Information -->

        <!-- Begin Contact Automation Information -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="v-center justify-content-between w-100">
                <div class="v-center">
                  <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                  <span class="f-6 font-weight-bold ml-2">Automation</span>
                </div>
                <!-- <div class="f-3 fw-600 c-blue c-pointer" (click)="createAutomation()">
                  Create own automation
                </div> -->
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="automation">
            <div class="v-center">
              <app-input-automation (automationChange)="selectAutomation($event)"></app-input-automation>
              <div class="v-center automation-action ml-2">
                <ng-container *ngIf="!assigning; else assigningTemplate">
                  <i class="d-block i-icon i-automation-start bgc-green-weak c-pointer" (click)="assignAutomation()"></i>
                </ng-container>
                <ng-template #assigningTemplate>
                  <i class="d-block assigning loader"></i>
                </ng-template>
                <ng-container *ngIf="!canceling; else cancelingTemplate">
                  <i class="d-block i-icon i-automation-cancel bgc-blue ml-2 c-pointer" (click)="closeAutomation()"></i>
                </ng-container>
                <ng-template #cancelingTemplate>
                  <i class="d-block canceling loader ml-2"></i>
                </ng-template>
              </div>
            </div>
            <div class="automation-detail mt-3" *ngIf="allDataSource.data?.length">
              <mat-tree [dataSource]="dataSource" [treeControl]="treeControl"
              class="timeline timeline-one-side time-line">
                <mat-tree-node class="mat-tree" [class.first]="node['condition'] && node['condition']['answer'] == true" *matTreeNodeDef="let node" matTreeNodeToggle>
                  <li class="mat-tree-node timeline-block {{ node.status }}">
                    <div class="timeline w-100">
                      <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == true">
                        <img src="../../assets/img/automations/yes.svg">
                        <span class="f-1 font-weight-bold text-center w-100" *ngIf="node['condition']">{{ActionName[node['condition']['case']]}}?</span>
                      </div>
                      <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == false">
                        <img src="../../assets/img/automations/no.svg">
                      </div>
                      <div class="bgc-green-weak line"></div>
                      <div class="v-center c-pointer" #treeNode (click)="easyView(node, treeNode, treeOverlay)">
                        <span class="timeline-step {{ node.action?.type }}">
                          <img [attr.src]="ICONS[node.action?.type]">
                        </span>
                        <div class="timeline-content ml-1">
                          <div class="f-1 font-weight-bold title m-0">
                            {{ ActionName[node.action?.type] }}
                          </div>
                          <div class="f-1 font-weight-bold text-left text-uppercase p-0 badge status {{ node.status }}">
                            {{ node.status }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                </mat-tree-node>
                <mat-nested-tree-node class="mat-nested-tree" [class.first]="node['condition'] && node['condition']['answer'] == true" *matTreeNodeDef="let node; when: hasChild">
                  <div class="timeline-condition" *ngIf="node['condition'] && node['condition']['case']">
                    <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == true">
                      <img src="../../assets/img/automations/yes.svg">
                      <span class="f-1 font-weight-bold text-center w-100" *ngIf="node['condition']">{{ActionName[node['condition']['case']]}}?</span>
                    </div>
                    <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == false">
                      <img src="../../assets/img/automations/no.svg">
                    </div>
                    <div class="bgc-green-weak line"></div>
                  </div>
                  <li>
                    <div class="d-flex mat-tree-node timeline-block c-pointer" #nestedTreeNode (click)="easyView(node, nestedTreeNode, treeOverlay)">
                      <span class="timeline-step {{ node.action?.type }}">
                        <img [attr.src]="ICONS[node.action?.type]">
                      </span>
                      <div class="timeline-content ml-1">
                        <div class="f-1 font-weight-bold title m-0">
                          {{ ActionName[node.action?.type] }}
                        </div>
                        <div class="f-1 font-weight-bold text-left text-uppercase p-0 badge status {{ node.status }}">
                          {{ node.status }}
                        </div>
                      </div>
                    </div>
                    <div class="bgc-green-weak line"></div>
                    <div class="d-flex p-0" [class.timeline-tree-invisible]="
                        !treeControl.isExpanded(node)
                      ">
                      <ng-container matTreeNodeOutlet></ng-container>
                    </div>
                  </li>
                </mat-nested-tree-node>
                <ng-template #treeOverlay let-close="close" let-data>
                  <app-automation-tree-overlay
                      [dataSource]="data.data"
                      [type]="'easy'"
                  >
                  </app-automation-tree-overlay>
                </ng-template>
              </mat-tree>
              <div class="v-center justify-content-center f-6 font-weight-bold c-blue c-pointer mt-3" (click)="showFullAutomation()">
                Show full automation
              </div>
            </div>
          </div>
        </mat-expansion-panel>
        <!-- Begin Contact Automation Information -->
      </mat-accordion>
    </div>
    <div class="contact-action-panel flex-grow-1 position-relative">
      <div class="history-panel pt-3 pl-3 mt-2">
        <app-slide-tab [tabs]="tabs" [selected]="tab" (onChange)="changeTab($event)" type="plain" class="border-bottom pl-0 rounded-0">
        </app-slide-tab>
        <div class="history-list mt-3 position-relative">
          <div class="history-list-header v-center">
            <ng-container *ngIf="tab.id === 'all'">
              <div ngbDropdown class="v-center">
                <div class="v-center" ngbDropdownToggle>
                  <span class="f-3 font-weight-bold c-dark c-pointer mr-2">
                    {{activityType.id == 'all' ? 'All activity' : activityType.label}}
                  </span>
                  <i class="d-block i-icon i-triangle-down bgc-dark"></i>
                </div>
                <div ngbDropdownMenu class="light">
                  <div class="v-center justify-content-between dropdown-item" *ngFor="let tabItem of tabs" (click)="changeActivityTypes(tabItem)">
                    <div class="f-3 c-dark" [ngClass]="{'font-weight-bold': tabItem.id == activityType.id}" *ngIf="tabItem.id == 'all'; else others">
                      All activity
                    </div>
                    <ng-template #others>
                      <div class="f-3 c-dark" [ngClass]="{'font-weight-bold': tabItem.id == activityType.id}">
                        {{tabItem.label}}
                      </div>
                    </ng-template>
                    <div *ngIf="tabItem.id == activityType.id">
                      <i class="d-block i-icon i-check bgc-blue"></i>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
            <ng-container *ngIf="tab.id === 'follow_up'">
              <div ngbDropdown class="v-center">
                <div class="v-center" ngbDropdownToggle>
                  <span class="f-3 font-weight-bold c-dark c-pointer mr-2">
                    {{selectedTimeSort.label}}
                  </span>
                  <i class="d-block i-icon i-triangle-down bgc-dark"></i>
                </div>
                <div ngbDropdownMenu class="light">
                  <div class="v-center justify-content-between dropdown-item" *ngFor="let timeSort of timeSorts" (click)="changeSort(timeSort)">
                    <div class="f-3 c-dark" [ngClass]="{'font-weight-bold': timeSort.id == selectedTimeSort.id}">
                      {{timeSort.label}}
                    </div>
                    <div *ngIf="timeSort.id == selectedTimeSort.id">
                      <i class="d-block i-icon i-check bgc-blue"></i>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openNoteDlg()" *ngIf="tab.id === 'note' || (tab.id !== 'all' && activityType.id === 'note')">
              <span class="f-3 font-weight-bold c-blue mr-2">Add new note</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openSendEmail()" *ngIf="tab.id === 'email' || (tab.id === 'all' && activityType.id === 'email')">
              <span class="f-3 font-weight-bold c-blue mr-2">Send email</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openSendText()" *ngIf="tab.id === 'text' || (tab.id === 'all' && activityType.id === 'text')">
              <span class="f-3 font-weight-bold c-blue mr-2">Send text</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openAppointmentDlg()" *ngIf="tab.id === 'appointment' || (tab.id === 'all' && activityType.id === 'appointment')">
              <span class="f-3 font-weight-bold c-blue mr-2">Create appointment</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openGroupCallDlg()" *ngIf="tab.id === 'group_call' || (tab.id === 'all' && activityType.id === 'group_call')">
              <span class="f-3 font-weight-bold c-blue mr-2">Create group call</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openTaskDlg()" *ngIf="tab.id === 'follow_up' || (tab.id === 'all' && activityType.id === 'follow_up')">
              <span class="f-3 font-weight-bold c-blue mr-2">Create task</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
            <div class="v-center justify-content-end c-pointer ml-auto" (click)="openDealDlg()" *ngIf="tab.id === 'deal' || (tab.id === 'all' && activityType.id === 'deal')">
              <span class="f-3 font-weight-bold c-blue mr-2">Create deal</span>
              <i class="d-block i-icon i-plus bgc-blue"></i>
            </div>
          </div>
          <ng-container *ngIf="tab.id === 'all'; else detailsTemplate">
            <ng-container *ngIf="activityType.id !== 'all' && !activityCounts[activityType.id]">
              <div class="empty-list">
                <div class="object-icon v-center">
                  <i class="i-icon i-{{activityType.id}}s d-block bgc-dark"></i>
                </div>
                <h4 class="font-weight-bold mt-4 mb-3">
                  There are no {{activityType.label | lowercase}} with this contact yet.
                </h4>
              </div>
            </ng-container>
            <ng-container *ngFor="let activity of mainTimelines">
              <div *ngIf="activityType.id == 'all' && activity.type == 'contacts'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="f-3 op-56 ml-auto mr-span">
                      {{activity.created_at | date :'MMM d, hh:mm a'}}
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'follow_up') && activity.type == 'follow_ups'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center">
                      <span class="f-3 op-56 ml-auto">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                      <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <ng-container *ngIf="activity.activity_detail; else removedTaskAction">
                            <button
                              class="v-center border-0 py-1 c-dark dropdown-item"
                              *ngIf="!activity.activity_detail.status"
                              (click)="editTask(activity)"
                            >
                              <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Edit</span>
                            </button>
                            <button
                              class="v-center border-0 py-1 c-dark dropdown-item"
                              *ngIf="!activity.activity_detail.status"
                              (click)="completeTask(activity)"
                            >
                              <i class="i-icon i-check bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Complete</span>
                            </button>
                            <button
                              class="v-center border-0 py-1 c-dark dropdown-item"
                              (click)="archiveTask(activity)"
                            >
                              <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Delete</span>
                            </button>
                          </ng-container>
                          <ng-template #removedTaskAction>
                            <button
                              class="v-center border-0 py-1 c-dark dropdown-item"
                              (click)="removeActivity(activity)"
                            >
                              <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Delete</span>
                            </button>
                          </ng-template>
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedTaskTemplate">
                    <div class="main-history-item" [class.completed]="activity.content.indexOf('completed') !== -1">
                      <div class="v-center">
                        <div class="v-center justify-content-center c-pointer task-status" (click)="completeTask(activity)"
                          *ngIf="activity.content.indexOf('completed') === -1; else taskComplete">
                          <i class="i-icon i-check bgc-white"></i>
                        </div>
                        <ng-template #taskComplete>
                          <div class="v-center justify-content-center task-status">
                            <i class="i-icon i-check bgc-white"></i>
                          </div>
                        </ng-template>
                        <div class="f-6 font-weight-bold ml-3 content">
                          {{activity.activity_detail.content}}
                        </div>
                      </div>
                      <div class="v-center mt-3" *ngIf="activity.content.indexOf('completed') === -1">
                        <div class="time">
                          <div class="f-4 fw-600 op-40">
                            Due date
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-calendar bgc-dark mr-2"></i>
                            <span class="f-4">{{activity.activity_detail.due_date | timezone: timezone:'MM/D/YYYY'}} at {{activity.activity_detail.due_date | timezone: timezone: 'hh:mm A'}}</span>
                          </div>
                        </div>
                        <div class="type ml-5">
                          <div class="f-4 fw-600 op-40">
                            Type
                          </div>
                          <div class="v-center mt-1">
                            <ng-container [ngSwitch]="activity.activity_detail.type">
                              <i class="d-block i-icon i-task bgc-dark mr-2" *ngSwitchCase="'task'"></i>
                              <i class="d-block i-icon i-phone bgc-dark mr-2" *ngSwitchCase="'call'"></i>
                              <i class="d-block i-icon i-lunch bgc-dark mr-2" *ngSwitchCase="'meeting'"></i>
                              <i class="d-block i-icon i-message bgc-dark mr-2" *ngSwitchCase="'email'"></i>
                              <i class="d-block i-icon i-video bgc-dark mr-2" *ngSwitchCase="'material'"></i>
                            </ng-container>
                            <span class="f-4 text-capitalize">{{activity.activity_detail.type}}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-template #removedTaskTemplate>
                    <div class="d-flex">
                      <mat-icon class="mr-2">warning</mat-icon>
                      <span>Can't see the detail as it is deleted.</span>
                    </div>
                  </ng-template>
                  <div class="related-history-item" *ngIf="groupActions[activity.group_id].length > 1">
                    <app-accordion [showIndicator]="show" [hideIndicator]="hide">
                      <ng-template #show>
                        <div class="content">
                          <div class="f-3 fw-600 c-blue mt-1">
                            See details
                          </div>
                        </div>
                      </ng-template>
                      <ng-template #hide>
                        <div class="content w-100">
                          <ng-container *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                            <div class="d-flex mb-1">
                              <div class="mr-2 font-weight-bold"># {{groupActions[activity.group_id].length - i}}</div>
                              <div class="mr-2 text-capitalize rounded-pill bgc-green-weak text-white px-3">{{detailActivity.content}}</div>
                              <div class="ml-auto c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                            </div>
                          </ng-container>
                          <div class="f-3 fw-600 c-blue mt-1">
                            Close
                          </div>
                        </div>
                      </ng-template>
                    </app-accordion>
                  </div>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'note') && activity.type == 'notes'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center">
                      <span class="f-3 op-56 ml-auto">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                      <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <ng-container *ngIf="activity.activity_detail; else removedNoteAction">
                            <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="updateNote(activity)">
                              <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Edit</span>
                            </button>
                            <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="deleteNote(activity)">
                              <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Delete</span>
                            </button>
                          </ng-container>
                          <ng-template #removedNoteAction>
                            <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="removeActivity(activity)">
                              <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                              <span class="ml-3 f-2 font-weight-bold">Delete</span>
                            </button>
                          </ng-template>
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedNoteTemplate">
                    <div class="main-history-item">
                      <app-accordion [showIndicator]="show" [hideIndicator]="hide" *ngIf="activity.activity_detail.content">
                        <ng-template #show>
                          <div class="content f-6 position-relative">
                            <div class="note-content">{{activity.activity_detail.content || 'No Content Note' | stripTags | shorten: 300: '...' }}</div>
                            <div class="gradient-bottom"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Expand
                            </div>
                          </div>
                        </ng-template>
                        <ng-template #hide>
                          <div class="content">
                            <div class="f-6 note-content opened" [innerHTML]="activity.activity_detail.content"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Collapse
                            </div>
                          </div>
                        </ng-template>
                      </app-accordion>
                    </div>
                  </ng-container>
                  <ng-template #removedNoteTemplate>
                    <div class="d-flex">
                      <mat-icon class="mr-2">warning</mat-icon>
                      <span>Can't see the detail as it is deleted.</span>
                    </div>
                  </ng-template>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'email') && (activity.type == 'emails' || activity.type == 'email_trackers')">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center ml-auto mr-span">
                      <span class="f-3 op-56">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail;">
                    <div class="main-history-item">
                      <ng-container *ngIf="groupActions[activity.group_id].length === 1; else multiEmailHistory">
                        <div class="summary position-relative">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.emails]?.subject}}
                          </div>
                          <div class="f-6 detail-content" [innerHTML]="convertContent(details[activity.emails]?.content) | makeRedirect"></div>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.emails]?.subject}}
                          </div>
                          <div class="f-6" [innerHTML]="(details[activity.emails]?.content || 'No Content') | makeRedirect"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-container>
                      <ng-template #multiEmailHistory>
                        <div class="summary position-relative">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.emails]?.subject}}
                          </div>
                          <div class="f-6 detail-content" [innerHTML]="convertContent(details[activity.emails]?.content) | makeRedirect"></div>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.emails]?.subject}}
                          </div>
                          <div class="f-6 mb-2" [innerHTML]="(details[activity.emails]?.content || '') | makeRedirect"></div>
                          <table class="table">
                            <thead>
                              <tr>
                                <th class="session-col">session</th>
                                <th class="duration-col">duration</th>
                                <th class="date-col">date</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                                <td class="session-col">
                                  <span class="font-weight-bold mr-2">
                                    {{detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch' ? getSessionIndex(i, groupActions[activity.group_id]) : ''}}
                                  </span>
                                  <span class="font-weight-bold">{{detailActivity.content}}</span>
                                </td>
                                <td class="duration-col">{{details[activity.emails]?.duration || '' | timeDuration}}</td>
                                <td class="date-col">
                                  <div class="f-3 font-weight-bold text-uppercase px-2 py-1 c-pointer" ngbTooltip="{{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}">
                                    {{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <div class="c-blue mt-2 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-template>
                    </div>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'text') && (activity.type == 'texts' || activity.type == 'text_trackers')">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center ml-auto mr-span">
                      <span class="f-3 op-56">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedTextTemplate">
                    <div class="main-history-item">
                      <div class="text-direction mb-3">
                        <ng-container *ngIf="activity.content.indexOf('sent') !== -1; else receivedDir">
                          <h6 class="font-weight-bold mb-0">{{(userService.profile$ | async).user_name}}</h6>
                          <div class="op-75 f-3">to {{contact.fullName}}</div>
                        </ng-container>
                        <ng-template #receivedDir>
                          <h6 class="font-weight-bold mb-0">{{contact.fullName}}</h6>
                          <div class="op-75 f-3">to {{(userService.profile$ | async).user_name}}</div>
                        </ng-template>
                      </div>
                      <div class="f-6 text-content opened" [innerHTML]="convertTextContent(activity.activity_detail.content)"></div>
                    </div>
                  </ng-container>
                  <ng-template #removedTextTemplate>
                    <!-- <div class="d-flex">
                      <mat-icon class="mr-2">warning</mat-icon>
                      <span>Can't see the detail</span>
                    </div> -->
                  </ng-template>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'email') && (activity.type == 'videos' || activity.type == 'video_trackers') && (groupActions[activity.group_id].length > 1 || (!activity.emails && !activity.texts))">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center ml-auto mr-span">
                      <span class="f-3 op-56">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail;">
                    <div class="main-history-item">
                      <ng-container *ngIf="groupActions[activity.group_id].length === 1; else multiVideoHistory">
                        <div class="material-sent-activity-content">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.videos]?.title}}
                          </div>
                          <a class="material-thumbnail" href="{{SITE}}/video?video={{details[activity.videos]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.videos]?.preview}}"/>
                          </a>
                          <div class="f-6 mb-3 description" [innerHTML]="details[activity.videos]?.description || '' | stripTags | shorten: 300: '...'  | makeRedirect"></div>
                        </div>
                        <!-- <div class="summary position-relative">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.videos]?.title}}
                          </div>
                          <a class="material-thumbnail" href="{{SITE}}/video?video={{details[activity.videos]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.videos]?.preview}}"/>
                          </a>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.videos]?.title}}
                          </div>
                          <a class="material-thumbnail" href="{{SITE}}/video?video={{details[activity.videos]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.videos]?.preview}}"/>
                          </a>
                          <div class="f-6 mb-3" [innerHTML]="details[activity.videos]?.description || '' | stripTags | shorten: 300: '...'  | makeRedirect"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div> -->
                      </ng-container>
                      <ng-template #multiVideoHistory>
                        <div [innerHTML]="getVideoBadge(activity)" class="d-flex"></div>
                        <div class="summary position-relative">
                          <a class="material-thumbnail" href="{{SITE}}/video?video={{details[activity.videos]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.videos]?.preview}}"/>
                            <div class="video-duration">{{details[activity.videos]?.duration | timeDuration}}</div>
                          </a>
                          <div class="recent-activity v-center f-1 border-bottom mb-1">
                            <div class="content label">SESSION</div>
                            <ng-container *ngIf="activity.activity_detail && activity.activity_detail?.type === 'watch'">
                              <div class="duration ml-auto label">
                                DURATION
                              </div>
                              <div class="from label">
                                FROM
                              </div>
                              <div class="to label">
                                TO
                              </div>
                            </ng-container>
                            <div class="label date text-right">DATE</div>
                          </div>
                          <div class="recent-activity v-center mb-4 f-4">
                            <div class="content font-weight-bold">{{activity.content}}</div>
                            <ng-container *ngIf="activity.activity_detail && activity.activity_detail?.type === 'watch'">
                              <div class="duration ml-auto">
                                {{(activity.activity_detail.type ? (activity.activity_detail.duration || '--') + 's' : '') | timeDuration}}
                              </div>
                              <div class="from">
                                {{(activity.activity_detail.start * 1000 || (activity.activity_detail.material_last ? activity.activity_detail.material_last * 1000 - activity.activity_detail.duration : 0)) | timeDuration}}
                              </div>
                              <div class="to">
                                {{(activity.activity_detail.to *1000 || activity.activity_detail.material_last*1000) | timeDuration}}
                              </div>
                            </ng-container>
                            <div class="date border border-primary rounded-pill c-blue font-weight-bold f-2">{{activity.created_at | date: 'MMM dd yyyy, hh:mm a'}}</div>
                          </div>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <a class="material-thumbnail" href="{{SITE}}/video?video={{details[activity.videos]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.videos]?.preview}}"/>
                            <div class="video-duration">{{details[activity.videos]?.duration | timeDuration}}</div>
                          </a>
                          <div class="f-6 mb-3" [innerHTML]="details[activity.videos]?.description || '' | stripTags | shorten: 300: '...'  | makeRedirect"></div>
                          <table class="table">
                            <thead>
                              <tr>
                                <th class="session-col">session</th>
                                <th class="duration-col">duration</th>
                                <th class="start-col">from</th>
                                <th class="end-col">to</th>
                                <th class="date-col">date</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index; let c = count;">
                                <td class="session-col">
                                  <span class="font-weight-bold mr-2">{{detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch' ? getSessionIndex(i, groupActions[activity.group_id]) : ''}}</span>
                                  <span class="font-weight-bold">{{detailActivity.content}}</span>
                                </td>
                                <ng-container *ngIf="detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch'; else normalTracker">
                                  <td class="duration-col">{{(detailActivity.activity_detail.type ? (detailActivity.activity_detail.duration || '--') + 's' : '') | timeDuration}}</td>
                                  <td class="start-col">{{(detailActivity.activity_detail.start * 1000 || (detailActivity.activity_detail.material_last ? detailActivity.activity_detail.material_last * 1000 - detailActivity.activity_detail.duration : 0)) | timeDuration}}</td>
                                  <td class="end-col">{{(detailActivity.activity_detail.to *1000 || detailActivity.activity_detail.material_last*1000) | timeDuration}}</td>
                                </ng-container>
                                <ng-template #normalTracker>
                                  <td class="duration-col"></td>
                                  <td class="start-col"></td>
                                  <td class="end-col"></td>
                                </ng-template>
                                
                                <td class="date-col">
                                  <div class="f-3 font-weight-bold text-uppercase px-2 py-1 c-pointer" ngbTooltip="{{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}">
                                    {{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <div class="c-blue mt-2 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-template>
                    </div>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'email') && (activity.type == 'pdfs' || activity.type == 'pdf_trackers') && (groupActions[activity.group_id].length > 1 || (!activity.emails && !activity.texts))">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center ml-auto mr-span">
                      <span class="f-3 op-56">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail;">
                    <div class="main-history-item">
                      <ng-container *ngIf="groupActions[activity.group_id].length === 1; else multiPdfHistory">
                        <div class="material-sent-activity-content">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.pdfs]?.title}}
                          </div>
                          <a class="material-thumbnail" href="{{SITE}}/pdf?pdf={{details[activity.pdfs]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.pdfs]?.preview}}"/>
                          </a>
                          <div class="f-6 mb-3" [innerHTML]="details[activity.pdfs]?.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                        </div>
                      </ng-container>
                      <ng-template #multiPdfHistory>
                        <div [innerHTML]="getPdfImageBadge(activity)" class="d-flex"></div>
                        <div class="summary position-relative">
                          <a class="material-thumbnail" href="{{SITE}}/pdf?pdf={{details[activity.pdfs]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.pdfs]?.preview}}"/>
                          </a>
                          <div class="recent-activity v-center f-1 border-bottom mb-1">
                            <div class="content label">SESSION</div>
                            <ng-container *ngIf="activity.activity_detail && activity.activity_detail?.type === 'watch'">
                              <div class="duration ml-auto label">
                                DURATION
                              </div>
                            </ng-container>
                            <div class="label date text-right">DATE</div>
                          </div>
                          <div class="recent-activity v-center mb-4 f-4">
                            <div class="content font-weight-bold">{{activity.content}}</div>
                            <ng-container *ngIf="activity.activity_detail && activity.activity_detail?.type === 'watch'">
                              <div class="duration"></div>
                            </ng-container>
                            <div class="date ml-auto f-2 border border-primary rounded-pill c-blue font-weight-bold">{{activity.created_at | date: 'MMM dd yyyy, hh:mm a'}}</div>
                          </div>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <a class="material-thumbnail" href="{{SITE}}/pdf?pdf={{details[activity.pdfs]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.pdfs]?.preview}}"/>
                          </a>
                          <div class="f-6 mb-3" [innerHTML]="details[activity.pdfs]?.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                          <ng-container *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                            <div class="d-flex mb-1">
                              <div class="mr-2 font-weight-bold"># {{groupActions[activity.group_id].length - i}}</div>
                              <div class="mr-2 text-capitalize rounded-pill bgc-orange-weak text-white px-3">{{detailActivity.content}}</div>
                              <div class="ml-auto c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                            </div>
                          </ng-container>
                          <div class="c-blue mt-2 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-template>
                    </div>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'email') && (activity.type == 'images' || activity.type == 'image_trackers') && (groupActions[activity.group_id].length > 1 || (!activity.emails && !activity.texts))">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center ml-auto mr-span">
                      <span class="f-3 op-56">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedTaskTemplate">
                    <div class="main-history-item">
                      <ng-container *ngIf="groupActions[activity.group_id].length === 1; else multiImageHistory">
                        <div class="material-sent-activity-content">
                          <div class="title f-6 font-weight-bold">
                            {{details[activity.images]?.title}}
                          </div>
                          <a class="material-thumbnail" href="{{SITE}}/image?image={{details[activity.images]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.images]?.preview}}"/>
                          </a>
                          <div class="f-6 mb-3 description" [innerHTML]="details[activity.images]?.description || '' | stripTags | shorten: 300: '...'  | makeRedirect"></div>
                        </div>
                      </ng-container>
                      <ng-template #multiImageHistory>
                        <div [innerHTML]="getPdfImageBadge(activity)" class="d-flex"></div>
                        <div class="summary position-relative">
                          <a class="material-thumbnail" href="{{SITE}}/image?image={{details[activity.images]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.images]?.preview}}"/>
                          </a>
                          <div class="recent-activity v-center f-1 border-bottom mb-1">
                            <div class="content label">SESSION</div>
                            <ng-container *ngIf="activity.activity_detail && activity.activity_detail?.type === 'watch'">
                              <div class="duration ml-auto label">
                                DURATION
                              </div>
                            </ng-container>
                            <div class="label date text-right">DATE</div>
                          </div>
                          <div class="recent-activity v-center mb-4 f-4">
                            <div class="content font-weight-bold">{{activity.content}}</div>
                            <ng-container *ngIf="activity.activity_detail && activity.activity_detail?.type === 'watch'">
                              <div class="duration"></div>
                            </ng-container>
                            <div class="date ml-auto f-2 border border-primary rounded-pill c-blue font-weight-bold">{{activity.created_at | date: 'MMM dd yyyy, hh:mm a'}}</div>
                          </div>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <a class="material-thumbnail" href="{{SITE}}/image?image={{details[activity.images]?._id}}&user={{userId}}" target="_blank">
                            <img src="{{details[activity.images]?.preview}}"/>
                          </a>
                          <div class="f-6 mb-3" [innerHTML]="details[activity.images]?.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                          <ng-container *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                            <div class="d-flex mb-1">
                              <div class="mr-2 font-weight-bold"># {{groupActions[activity.group_id].length - i}}</div>
                              <div class="mr-2 text-capitalize rounded-pill bgc-orange-weak text-white px-3">{{detailActivity.content}}</div>
                              <div class="ml-auto c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                            </div>
                          </ng-container>
                          <div class="c-blue mt-2 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-template>
                    </div>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'appointment') && activity.type == 'appointments'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center">
                      <span class="f-3 op-56 ml-auto">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                      <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="removeActivity(activity)">
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete activity</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedAppointmentTemplate">
                    <div class="main-history-item">
                      <div class="summary">
                        <div class="content f-6 position-relative">
                          <a class="font-weight-bold c-pointer ci-dark td-none appt-title" (click)="openDetailEvent(activity.activity_detail, $event)">
                            {{activity.activity_detail.title}}
                          </a>
                          <div class="f-6" [innerHTML]="activity.activity_detail.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                          <div class="gradient-bottom"></div>
                          <div class="f-3 fw-600 c-blue mt-1 c-pointer" (click)="showDetail($event)">
                            Expand
                          </div>
                        </div>
                      </div>
                      <div class="detail">
                        <div class="content">
                          <a class="f-6 font-weight-bold c-pointer ci-dark td-none appt-title" (click)="openDetailEvent(activity.activity_detail, $event)">
                            {{activity.activity_detail.title}}
                          </a>
                          <div class="f-6" [innerHTML]="activity.activity_detail.description || '' | makeRedirect"></div>
                          <div class="f-3 fw-600 c-blue mt-1 c-pointer" (click)="hideDetail($event)">
                            Collapse
                          </div>
                        </div>
                      </div>
                      <div class="v-center mt-3">
                        <div class="date">
                          <div class="f-4 fw-600 op-40">
                            Date
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-calendar bgc-dark mr-2"></i>
                            <span class="f-4">{{activity.activity_detail.due_start | date: 'MM/dd/yyyy'}}</span>
                          </div>
                        </div>
                        <div class="time ml-5">
                          <div class="f-4 fw-600 op-40">
                            Time
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-timer bgc-dark mr-2"></i>
                            <span class="f-4">{{getTime(activity.activity_detail.due_start, activity.activity_detail.due_end)}}</span>
                          </div>
                        </div>
                        <div class="location ml-5">
                          <div class="f-4 fw-600 op-40">
                            Location
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-location bgc-dark mr-2"></i>
                            <span class="f-4">{{activity.activity_detail.location}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="activity.activity_detail.zoom_link">
                        <div class="f-4 fw-600 op-40">
                          Zoom meeting
                        </div>
                        <div class="f-4 c-blue mt-1">
                          {{activity.activity_detail.zoom_link}}
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-template #removedAppointmentTemplate>
                    <div class="d-flex">
                      <mat-icon class="mr-2">warning</mat-icon>
                      <span>Can't see the detail as it is deleted.</span>
                    </div>
                  </ng-template>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'group_call') && activity.type == 'team_calls'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center">
                      <span class="f-3 op-56 ml-auto">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                      <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="removeActivity(activity)">
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete activity</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedGroupCallTemplate">
                    <div class="main-history-item">
                      <div class="font-weight-bold c-pointer" (click)="openGroupCall(activity.activity_detail, $event)">
                        {{activity.activity_detail.subject}}
                      </div>
                      <app-accordion [showIndicator]="show" [hideIndicator]="hide">
                        <ng-template #show>
                          <div class="content f-6 position-relative">
                            <div class="call-status mb-3">
                              <div class="tag {{activity.activity_detail.status}}">{{activity.activity_detail.status}}</div>
                              <ng-container *ngIf="activity.activity_detail.status === 'planned'">
                              <span class="f-3"> on </span><span class="time f-3 font-weight-bold">{{activity.activity_detail.confirmed_at | date :'MMM d, hh:mm a'}}</span>
                              </ng-container>
                            </div>
                            <div class="f-6" [innerHTML]="activity.activity_detail.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                            <div class="gradient-bottom"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Expand
                            </div>
                          </div>
                        </ng-template>
                        <ng-template #hide>
                          <div class="content">
                            <div class="call-status mb-3">
                              <div class="tag {{activity.activity_detail.status}}">{{activity.activity_detail.status}}</div>
                              <ng-container *ngIf="activity.activity_detail.status === 'planned'">
                                on <span class="time">{{activity.activity_detail.confirmed_at | date :'MMM d, hh:mm a'}}</span>
                              </ng-container>
                            </div>
                            <div class="f-6" [innerHTML]="activity.activity_detail.description || '' | makeRedirect"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Collapse
                            </div>
                          </div>
                        </ng-template>
                      </app-accordion>
                      <div class="d-flex mt-3 partner-info">
                        <div class="leader">
                          <div class="f-4 fw-600 op-40">
                            Leader
                          </div>
                          <div class="v-center mt-1">
                            <ng-container *ngIf="editors[activity.activity_detail.leader]; else unknownLeader">
                              <img *ngIf="editors[activity.activity_detail.leader].picture_profile; else avatarNameTemplate" [src]="editors[activity.activity_detail.leader].picture_profile" onerror="( this.src = './assets/img/user_avatar.svg');" class="form-avatar rounded-circle mr-1" />
                              <ng-template #avatarNameTemplate>
                                <div class="form-avatar rounded-circle bg-dark mr-1">{{editors[activity.activity_detail.leader].avatarName}}</div>
                              </ng-template>
                              <div class="f-3 mr-2">{{editors[activity.activity_detail.leader].user_name}}</div>
                            </ng-container>
                            <ng-template #unknownLeader>
                              --
                            </ng-template>
                          </div>
                        </div>
                        <div class="contacts mr-4">
                          <div class="f-4 fw-600 op-40">
                            Contacts
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-lunch bgc-dark mr-2"></i>
                            <span class="f-4">{{activity.activity_detail.contacts?.length || 0}}</span>
                          </div>
                        </div>
                        <div class="time">
                          <div class="f-4 fw-600 op-40">
                            Duration
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-timer bgc-dark mr-2"></i>
                            <span class="f-4">{{activity.activity_detail.duration}}mins</span>
                          </div>
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="activity.activity_detail.desired_at">
                        <div class="f-4 fw-600 op-40">
                          Desired time
                        </div>
                        <div class="f-3 mt-1 fw-600">
                          {{activity.activity_detail.desired_at | date :'MMM d, hh:mm a'}}
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="activity.activity_detail.proposed_at && activity.activity_detail.proposed_at.length">
                        <div class="f-4 fw-600 op-40">
                          Proposed times
                        </div>
                        <div class="f-3 mt-1 fw-600" *ngFor="let time of activity.activity_detail.proposed_at">
                          {{time | date :'MMM d, hh:mm a'}}
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="activity.activity_detail.schedule_link">
                        <div class="f-4 fw-600 op-40">
                          Calendar Link
                        </div>
                        <div class="f-3 mt-1 c-blue">
                          {{activity.activity_detail.schedule_link}}
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-template #removedAppointmentTemplate>
                    <div class="d-flex">
                      <mat-icon class="mr-2">warning</mat-icon>
                      <span>Can't see the detail as it is deleted.</span>
                    </div>
                  </ng-template>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all' || activityType.id == 'deal') && activity.type == 'deals'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <a class="v-center link-wrapper" [routerLink]="['/deals/' + activity.activity_detail?._id]">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </a>
                    <div class="v-center">
                      <span class="f-3 op-56 ml-auto mr-span">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                      <!-- <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="updateNote(activity)">
                            <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Exclude from deal</span>
                          </button>
                          <button class="v-center border-0 py-1 c-dark dropdown-item" (click)="removeActivity(activity)">
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete</span>
                          </button>
                        </div>
                      </div> -->
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else removedDealTemplate">
                    <div class="main-history-item">
                      <div class="f-6 font-weight-bold">
                        <a class="ci-dark td-none" [routerLink]="['/deals/' + activity.activity_detail._id]">{{activity.activity_detail.title}}</a>
                      </div>
                      <div class="v-center mt-3">
                        <div class="stage">
                          <div class="f-4 fw-600 op-40">
                            Stage
                          </div>
                          <ng-container *ngFor="let dealStage of dealsService.stages$ | async">
                            <div class="f-4 mt-1" *ngIf="dealStage._id == activity.activity_detail.deal_stage">
                              {{dealStage.title}}
                            </div>
                          </ng-container>
                        </div>
                        <div class="d-flex c-pointer" ngbDropdown>
                          <div class="contacts ml-5" (click)="loadContacts(activity.activity_detail.contacts)" ngbDropdownToggle>
                            <div class="f-4 fw-600 op-40">
                              Contacts
                            </div>
                            <div class="v-center mt-1">
                              <i class="d-block i-icon i-lunch bgc-dark mr-2"></i>
                              <span class="f-4">{{activity.activity_detail.contacts?.length || 0}}</span>
                            </div>
                          </div>
                          <div ngbDropdownMenu class="contact-list light px-2">
                            <ng-container *ngIf="loadingContact; else showContacts">
                              <div class="list-loading text-center">
                                <div class="loader px-0"></div>
                              </div>
                            </ng-container>
                            <ng-template #showContacts>
                              <ng-container *ngFor="let contact of detailContacts">
                                <a class="v-center py-1 c-pointer link-wrapper" href="{{siteUrl}}/contact/{{contact._id}}" target="_blank">
                                  <div class="form-avatar rounded-circle bg-dark mr-1">{{contact.avatarName}}</div>
                                  <div class="info ml-2">
                                    <div class="f-2 font-weight-bold">{{contact.fullName}}</div>
                                    <div class="f-2">{{contact.email}}</div>
                                  </div>
                                </a>
                              </ng-container>
                            </ng-template>
                          </div>
                        </div>
                        <div class="value ml-5">
                          <div class="f-4 fw-600 op-40">
                            Value
                          </div>
                          <div class="f-4 mt-1">
                            $ {{activity.activity_detail.value}}
                          </div>
                        </div>
                      </div>
                      <ng-container *ngIf="groupActions[activity.group_id].length > 1">
                        <div class="summary">
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <div class="relative-activities pt-3">
                            <ng-container *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                              <div class="d-flex mb-1">
                                <div class="mr-2 f-3 font-weight-bold"># {{groupActions[activity.group_id].length - i}}</div>
                                <div class="mr-2 f-3 text-capitalize rounded-pill bgc-green-weak text-white px-3">{{detailActivity.content}}</div>
                                <div class="ml-auto f-3 c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                              </div>
                            </ng-container>
                          </div>
                          <div class="c-blue mt-2 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-container>
                    </div>
                  </ng-container>
                  <ng-template #removedDealTemplate>
                    <div class="d-flex">
                      <mat-icon class="mr-2">warning</mat-icon>
                      <span>You removed this deal or this contact was excluded from this deal.</span>
                    </div>
                  </ng-template>
                </div>
              </div>

              <div *ngIf="(activityType.id == 'all') && activity.type == 'users'">
                <div class="history-detail {{activity.type}}-detail p-3 mt-3">
                  <div class="v-center justify-content-between mb-3">
                    <div class="v-center">
                      <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
                      <div class="f-6">
                        <span>{{activity.content}}</span>
                      </div>
                    </div>
                    <div class="v-center">
                      <span class="f-3 op-56 ml-auto mr-span">{{activity.created_at | date :'MMM d, hh:mm a'}}</span>
                    </div>
                  </div>
                  <ng-container *ngIf="activity.activity_detail; else canceledUserTemplate">
                    <div class="main-history-item">
                      <label class="mb-0 op-75 f-3 mt-">Shared With</label>
                      <div class="v-center mt-2">
                        <img *ngIf="activity.activity_detail.picture_profile; else avatarNameTemplate" [src]="activity.activity_detail.picture_profile" onerror="( this.src = './assets/img/user_avatar.svg');" class="form-avatar rounded-circle mr-1" />
                        <ng-template #avatarNameTemplate>
                          <div class="form-avatar rounded-circle bg-dark mr-1">{{activity.activity_detail.user_name[0]}}</div>
                        </ng-template>
                        <div class="ml-2 font-weight-bold">{{activity.activity_detail.user_name}}</div>
                      </div>
                    </div>
                  </ng-container>
                  <ng-template #canceledUserTemplate>

                  </ng-template>
                </div>
              </div>
            </ng-container>
          </ng-container>

          <!-- Details Template -->
          <ng-template #detailsTemplate>
            <ng-container *ngIf="showingDetails.length; else emptyDetails">
              <ng-container *ngFor="let detail of showingDetails">
                <ng-container [ngSwitch]="tab.id">
                  <div class="history-detail notes-detail p-3 mt-3" *ngSwitchCase="'note'">
                    <div class="v-center justify-content-between mb-3">
                      <div class="history-icon mr-3"><i class="act-icon act-notes"></i></div>
                      <div class="">note</div>
                      <div class="ml-auto f-3 op-56">
                        {{detail.created_at | date :'MMM d, hh:mm a'}}
                      </div>
                      <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="updateNoteDetail(detail)"
                          >
                            <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Edit</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="deleteNoteDetail(detail)"
                          >
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete</span>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="main-history-item">
                      <app-accordion [showIndicator]="show" [hideIndicator]="hide">
                        <ng-template #show>
                          <div class="content f-6 position-relative">
                            <div class="note-content">{{detail.content || '' | stripTags | shorten: 300: '...' }}</div>
                            <div class="gradient-bottom"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Expand
                            </div>
                          </div>
                        </ng-template>
                        <ng-template #hide>
                          <div class="content">
                            <div class="f-6 note-content opened" [innerHTML]="detail.content"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Collapse
                            </div>
                          </div>
                        </ng-template>
                      </app-accordion>
                    </div>
                  </div>
                  <div class="history-detail emails-detail p-3 mt-3" *ngSwitchCase="'email'">
                    <div class="v-center justify-content-between mb-3">
                      <div class="history-icon mr-3"><i class="act-icon act-{{detail.data_type}}"></i></div>
                      <div class="">
                        <ng-container [ngSwitch]="detail.data_type">
                          <span *ngSwitchCase="'emails'">email</span>
                          <span *ngSwitchCase="'videos'">video</span>
                          <span *ngSwitchCase="'pdfs'">pdf</span>
                          <span *ngSwitchCase="'images'">image</span>
                        </ng-container>
                      </div>
                      <div class="ml-auto f-3 op-56 mr-span">
                        {{detail.updated_at | date :'MMM d, hh:mm a'}}
                      </div>
                      <!-- <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                        </div>
                      </div> -->
                    </div>
                    <div class="main-history-item">
                      <ng-container>
                        <div class="summary position-relative">
                          <div class="title f-6 font-weight-bold">
                            {{detail.data_type === 'emails' ? detail.subject : detail.title}}
                          </div>
                          <div *ngIf="detail.data_type === 'emails'; else materialDetailSummary;" class="f-6 detail-content" [innerHTML]="convertContent(detail.content) | makeRedirect">
                          </div>
                          <ng-template #materialDetailSummary>
                            <ng-container [ngSwitch]="detail.data_type">
                              <a *ngSwitchCase="'videos'" class="material-thumbnail" href="{{SITE}}/video?video={{detail._id}}&user={{userId}}" target="_blank">
                                <img src="{{detail.preview}}"/>
                              </a>
                              <a *ngSwitchCase="'pdfs'" class="material-thumbnail" href="{{SITE}}/pdf?pdf={{detail._id}}&user={{userId}}" target="_blank">
                                <img src="{{detail.preview}}"/>
                              </a>
                              <a *ngSwitchCase="'images'" class="material-thumbnail" href="{{SITE}}/image?image={{detail._id}}&user={{userId}}" target="_blank">
                                <img src="{{detail.preview}}"/>
                              </a>
                            </ng-container>
                          </ng-template>
                          <div class="gradient-bottom"></div>
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <div class="title f-6 font-weight-bold">
                            {{detail.data_type === 'emails' ? detail.subject : detail.title}}
                          </div>
                          <div *ngIf="detail.data_type === 'emails'; else materialDetail;" class="f-6 detail-content" [innerHTML]="detail.content | makeRedirect">
                          </div>
                          <ng-template #materialDetail>
                            <ng-container [ngSwitch]="detail.data_type">
                              <a *ngSwitchCase="'videos'" class="material-thumbnail" href="{{SITE}}/video?video={{detail._id}}&user={{userId}}" target="_blank">
                                <img src="{{detail.preview}}"/>
                              </a>
                              <a *ngSwitchCase="'pdfs'" class="material-thumbnail" href="{{SITE}}/pdf?pdf={{detail._id}}&user={{userId}}" target="_blank">
                                <img src="{{detail.preview}}"/>
                              </a>
                              <a *ngSwitchCase="'images'" class="material-thumbnail" href="{{SITE}}/image?image={{detail._id}}&user={{userId}}" target="_blank">
                                <img src="{{detail.preview}}"/>
                              </a>
                            </ng-container>
                            <div class="f-6 mb-3" [innerHTML]="detail.description || '' | stripTags | shorten: 300: '...'  | makeRedirect"></div>
                          </ng-template>
                          <table class="table"
                            *ngIf="(detail.data_type === 'emails' && sendActions[detail._id].length > 1) || (detail.data_type !== 'emails' && sendActions[detail.group_id].length > 1)">
                            <thead>
                              <tr>
                                <th class="session-col">session</th>
                                <th class="duration-col">duration</th>
                                <th class="start-col">from</th>
                                <th class="end-col">to</th>
                                <th class="date-col">date</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let detailActivity of (detail.data_type === 'emails' ? sendActions[detail._id] : sendActions[detail.group_id]); let i = index;">
                                <td class="session-col">
                                  <span class="font-weight-bold mr-2">{{detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch' ? getSessionIndex(i, detail.data_type === 'emails' ? sendActions[detail._id] : sendActions[detail.group_id]) : ''}}</span>
                                  <span class="font-weight-bold">{{detailActivity.content}}</span>
                                </td>
                                <ng-container *ngIf="detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch'; else normalTracker">
                                  <td class="duration-col">{{(detailActivity.activity_detail.type ? (detailActivity.activity_detail.duration || '--') + 's' : '') | timeDuration}}</td>
                                  <td class="start-col">{{(detailActivity.activity_detail.start * 1000 || (detailActivity.activity_detail.material_last ? detailActivity.activity_detail.material_last * 1000 - detailActivity.activity_detail.duration : 0)) | timeDuration}}</td>
                                  <td class="end-col">{{(detailActivity.activity_detail.to *1000 || detailActivity.activity_detail.material_last*1000) | timeDuration}}</td>
                                </ng-container>
                                <ng-template #normalTracker>
                                  <td class="duration-col"></td>
                                  <td class="start-col"></td>
                                  <td class="end-col"></td>
                                </ng-template>
                                <td class="date-col">
                                  <div class="f-3 font-weight-bold text-uppercase px-2 py-1 c-pointer" ngbTooltip="{{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}">
                                    {{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                          <div class="c-blue mt-2 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                        </div>
                      </ng-container>
                    </div>
                  </div>

                  <div class="history-detail texts-detail p-3 mt-3" *ngSwitchCase="'text'">
                    <div class="v-center justify-content-between mb-3">
                      <div class="history-icon mr-3"><i class="act-icon act-{{detail.data_type}}"></i></div>
                      <div class="">
                        <ng-container [ngSwitch]="detail.data_type">
                          <span *ngSwitchCase="'texts'">text</span>
                          <span *ngSwitchCase="'videos'">video</span>
                          <span *ngSwitchCase="'pdfs'">pdf</span>
                          <span *ngSwitchCase="'images'">image</span>
                        </ng-container>
                      </div>
                      <div class="ml-auto f-3 op-56 mr-span">
                        {{detail.updated_at | date :'MMM d, hh:mm a'}}
                      </div>
                    </div>
                    <div class="main-history-item">
                      <ng-container *ngIf="detail.data_type === 'texts'; else materialTextTemplate">
                        <div class="text-direction mb-3">
                          <ng-container *ngIf="detail['sent']; else receivedDir">
                            <h6 class="font-weight-bold mb-0">{{(userService.profile$ | async).user_name}}</h6>
                            <div class="op-75 f-3">to {{contact.fullName}}</div>
                          </ng-container>
                          <ng-template #receivedDir>
                            <h6 class="font-weight-bold mb-0">{{contact.fullName}}</h6>
                            <div class="op-75 f-3">to {{(userService.profile$ | async).user_name}}</div>
                          </ng-template>
                        </div>
                        <div class="f-6 text-content opened" [innerHTML]="convertTextContent(detail.content)"></div>
                      </ng-container>
                      <ng-template #materialTextTemplate>
                        <div class="title f-6 font-weight-bold">
                          {{detail.title}}
                        </div>
                        <ng-container [ngSwitch]="detail.data_type">
                          <a *ngSwitchCase="'videos'" class="material-thumbnail" href="{{SITE}}/video?video={{detail._id}}&user={{userId}}" target="_blank">
                            <img src="{{detail.preview}}"/>
                          </a>
                          <a *ngSwitchCase="'pdfs'" class="material-thumbnail" href="{{SITE}}/pdf?pdf={{detail._id}}&user={{userId}}" target="_blank">
                            <img src="{{detail.preview}}"/>
                          </a>
                          <a *ngSwitchCase="'images'" class="material-thumbnail" href="{{SITE}}/image?image={{detail._id}}&user={{userId}}" target="_blank">
                            <img src="{{detail.preview}}"/>
                          </a>
                        </ng-container>
                      </ng-template>
                      <ng-container *ngIf="sendActions[detail._id]?.length > 1 || sendActions[detail.group_id]?.length > 1 || detail.description">
                        <div class="summary">
                          <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="showDetail($event)">Expand</div>
                        </div>
                        <div class="detail">
                          <div class="pt-3">
                            <ng-container *ngIf="detail.data_type !== 'texts'">
                              <div class="f-6 mb-3" [innerHTML]="detail.description || '' | stripTags | shorten: 300: '...'  | makeRedirect"></div>
                            </ng-container>
                            <table class="table"
                                *ngIf="(detail.data_type === 'texts' && sendActions[detail._id]?.length > 1) || (detail.data_type !== 'texts' && sendActions[detail.group_id]?.length > 1)">
                                <thead>
                                  <tr>
                                    <th class="session-col">session</th>
                                    <th class="duration-col">duration</th>
                                    <th class="start-col">from</th>
                                    <th class="end-col">to</th>
                                    <th class="date-col">date</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let detailActivity of (detail.data_type === 'texts' ? sendActions[detail._id] : sendActions[detail.group_id]); let i = index;">
                                    <td class="session-col">
                                      <span class="font-weight-bold mr-2">{{detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch' ? getSessionIndex(i, detail.data_type === 'texts' ? sendActions[detail._id] : sendActions[detail.group_id]) : ''}}</span>
                                      <span class="font-weight-bold">{{detailActivity.content}}</span>
                                    </td>
                                    <ng-container *ngIf="detailActivity.activity_detail && detailActivity.activity_detail.type === 'watch'; else normalTracker">
                                      <td class="duration-col">{{(detailActivity.activity_detail.type ? (detailActivity.activity_detail.duration || '--') + 's' : '') | timeDuration}}</td>
                                      <td class="start-col">{{(detailActivity.activity_detail.start * 1000 || (detailActivity.activity_detail.material_last ? detailActivity.activity_detail.material_last * 1000 - detailActivity.activity_detail.duration : 0)) | timeDuration}}</td>
                                      <td class="end-col">{{(detailActivity.activity_detail.to *1000 || detailActivity.activity_detail.material_last*1000) | timeDuration}}</td>
                                    </ng-container>
                                    <ng-template #normalTracker>
                                      <td class="duration-col"></td>
                                      <td class="start-col"></td>
                                      <td class="end-col"></td>
                                    </ng-template>
                                    <td class="date-col">
                                      <div class="f-3 font-weight-bold text-uppercase px-2 py-1 c-pointer" ngbTooltip="{{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}">
                                        {{detailActivity.created_at | date: 'MMM dd yyyy, hh:mm a'}}
                                      </div>
                                    </td>
                                  </tr>
                                </tbody>
                              </table>
                            <div class="c-blue mt-1 f-3 fw-600 c-pointer" (click)="hideDetail($event)">Collapse</div>
                          </div>
                        </div>
                      </ng-container>
                    </div>
                  </div>

                  <div class="history-detail appointments-detail p-3 mt-3" *ngSwitchCase="'appointment'">
                    <div class="v-center justify-content-between mb-3">
                      <div class="history-icon mr-3"><i class="act-icon act-appointments"></i></div>
                      <div class="">appointment</div>
                      <div class="ml-auto f-3 op-56 mr-span">
                        {{detail.created_at | date :'MMM d, hh:mm a'}}
                      </div>
                      <!-- <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            *ngIf="!detail.status"
                            (click)="editTask(detail, true)"
                          >
                            <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Edit</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            *ngIf="!detail.status"
                            (click)="completeTask(detail, true)"
                          >
                            <i class="i-icon i-check bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">complete</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="archiveTask(detail, true)"
                          >
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete</span>
                          </button>
                        </div>
                      </div> -->
                    </div>
                    <div class="main-history-item">
                      <div class="summary">
                        <div class="content f-6 position-relative">
                          <a class="font-weight-bold c-pointer ci-dark td-none appt-title" (click)="openDetailEvent(detail, $event)">
                            {{detail.title}}
                          </a>
                          <div class="f-6" [innerHTML]="detail.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                          <div class="gradient-bottom"></div>
                          <div class="f-3 fw-600 c-blue mt-1 c-pointer" (click)="showDetail($event)">
                            Expand
                          </div>
                        </div>
                      </div>
                      <div class="detail">
                        <div class="content">
                          <a class="f-6 font-weight-bold c-pointer ci-dark td-none appt-title" (click)="openDetailEvent(detail, $event)">
                            {{detail.title}}
                          </a>
                          <div class="f-6" [innerHTML]="detail.description || '' | makeRedirect"></div>
                          <div class="f-3 fw-600 c-blue mt-1 c-pointer" (click)="hideDetail($event)">
                            Collapse
                          </div>
                        </div>
                      </div>
                      <div class="v-center mt-3">
                        <div class="date">
                          <div class="f-4 fw-600 op-40">
                            Date
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-calendar bgc-dark mr-2"></i>
                            <span class="f-4">{{detail.due_start | date: 'MM/dd/yyyy'}}</span>
                          </div>
                        </div>
                        <div class="time ml-5">
                          <div class="f-4 fw-600 op-40">
                            Time
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-timer bgc-dark mr-2"></i>
                            <span class="f-4">{{getTime(detail.due_start,detail.due_end)}}</span>
                          </div>
                        </div>
                        <div class="location ml-5">
                          <div class="f-4 fw-600 op-40">
                            Location
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-location bgc-dark mr-2"></i>
                            <span class="f-4">{{detail.location}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="detail.zoom_link">
                        <div class="f-4 fw-600 op-40">
                          Zoom meeting
                        </div>
                        <div class="f-4 c-blue mt-1">
                          {{detail.zoom_link}}
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="history-detail group_calls-detail p-3 mt-3" *ngSwitchCase="'group_call'">
                    <div class="v-center justify-content-between mb-3">
                      <div class="history-icon mr-3"><i class="act-icon act-team_calls"></i></div>
                      <div class="">group call</div>
                      <div class="ml-auto f-3 op-56 mr-span">
                        {{detail.created_at | date :'MMM d, hh:mm a'}}
                      </div>
                      <!-- <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            *ngIf="!detail.status"
                            (click)="editTask(detail, true)"
                          >
                            <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Edit</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            *ngIf="!detail.status"
                            (click)="completeTask(detail, true)"
                          >
                            <i class="i-icon i-check bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">complete</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="archiveTask(detail, true)"
                          >
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete</span>
                          </button>
                        </div>
                      </div> -->
                    </div>

                    <div class="main-history-item">
                      <div class="font-weight-bold overlay-action c-pointer" (click)="openGroupCall(detail, $event)">
                        {{detail.subject}}
                      </div>
                      <app-accordion [showIndicator]="show" [hideIndicator]="hide">
                        <ng-template #show>
                          <div class="content f-6 position-relative">
                            <div class="call-status mb-3">
                              <div class="tag {{detail.status}}">{{detail.status}}</div>
                              <ng-container *ngIf="detail.status === 'planned'">
                              <span class="f-3"> on </span><span class="time f-3 font-weight-bold">{{detail.confirmed_at | date :'MMM d, hh:mm a'}}</span>
                              </ng-container>
                            </div>
                            <div class="f-6" [innerHTML]="detail.description || '' | stripTags | shorten: 300: '...' | makeRedirect"></div>
                            <div class="gradient-bottom"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Expand
                            </div>
                          </div>
                        </ng-template>
                        <ng-template #hide>
                          <div class="content">
                            <div class="call-status mb-3">
                              <div class="tag {{detail.status}}">{{detail.status}}</div>
                              <ng-container *ngIf="detail.status === 'planned'">
                                on <span class="time">{{detail.confirmed_at | date :'MMM d, hh:mm a'}}</span>
                              </ng-container>
                            </div>
                            <div class="f-6" [innerHTML]="detail.description || '' | makeRedirect"></div>
                            <div class="f-3 fw-600 c-blue mt-1">
                              Collapse
                            </div>
                          </div>
                        </ng-template>
                      </app-accordion>
                      <div class="d-flex mt-3 partner-info">
                        <div class="leader">
                          <div class="f-4 fw-600 op-40">
                            Leader
                          </div>
                          <div class="v-center mt-1">
                            <ng-container *ngIf="editors[detail.leader]; else unknownLeader">
                              <img *ngIf="editors[detail.leader].picture_profile; else avatarNameTemplate" [src]="editors[detail.leader].picture_profile" onerror="( this.src = './assets/img/user_avatar.svg');" class="form-avatar rounded-circle mr-1" />
                              <ng-template #avatarNameTemplate>
                                <div class="form-avatar rounded-circle bg-dark mr-1 text-white text-center">{{editors[detail.leader].avatarName}}</div>
                              </ng-template>
                              <div class="f-3 mr-2">{{editors[detail.leader].user_name}}</div>
                            </ng-container>
                            <ng-template #unknownLeader>
                              --
                            </ng-template>
                          </div>
                        </div>
                        <div class="contacts mr-4">
                          <div class="f-4 fw-600 op-40">
                            Contacts
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-lunch bgc-dark mr-2"></i>
                            <span class="f-4">{{detail.contacts?.length || 0}}</span>
                          </div>
                        </div>
                        <div class="time">
                          <div class="f-4 fw-600 op-40">
                            Duration
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-timer bgc-dark mr-2"></i>
                            <span class="f-4">{{detail.duration}}mins</span>
                          </div>
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="detail.desired_at">
                        <div class="f-4 fw-600 op-40">
                          Desired time
                        </div>
                        <div class="f-3 mt-1 fw-600">
                          {{detail.desired_at | date :'MMM d, hh:mm a'}}
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="detail.proposed_at && detail.proposed_at.length">
                        <div class="f-4 fw-600 op-40">
                          Proposed times
                        </div>
                        <div class="f-3 mt-1 fw-600" *ngFor="let time of detail.proposed_at">
                          {{time | date :'MMM d, hh:mm a'}}
                        </div>
                      </div>
                      <div class="mt-4" *ngIf="detail.schedule_link">
                        <div class="f-4 fw-600 op-40">
                          Calendar Link
                        </div>
                        <div class="f-3 mt-1 c-blue">
                          {{detail.schedule_link}}
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="history-detail follow_ups-detail p-3 mt-3" *ngSwitchCase="'follow_up'">
                    <div class="v-center justify-content-between mb-3">
                      <div class="history-icon mr-3"><i class="act-icon act-follow_ups"></i></div>
                      <div class="">task</div>
                      <div class="ml-auto f-3 op-56">
                        {{detail.created_at | date :'MMM d, hh:mm a'}}
                      </div>
                      <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            *ngIf="!detail.status"
                            (click)="editTask(detail, true)"
                          >
                            <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Edit</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            *ngIf="!detail.status"
                            (click)="completeTask(detail, true)"
                          >
                            <i class="i-icon i-check bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">complete</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="archiveTask(detail, true)"
                          >
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete</span>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="main-history-item" [class.completed]="detail.status">
                      <div class="v-center">
                        <div class="v-center justify-content-center c-pointer task-status" (click)="completeTask(detail, true)"
                          *ngIf="!detail.status; else completedTaskMark">
                          <i class="i-icon i-check bgc-white"></i>
                        </div>
                        <ng-template #completedTaskMark>
                          <div class="v-center justify-content-center task-status">
                            <i class="i-icon i-check bgc-white d-block"></i>
                          </div>
                        </ng-template>
                        <div class="f-6 font-weight-bold ml-3 content">
                          {{detail.content}}
                        </div>
                      </div>
                      <div class="v-center mt-3">
                        <div class="time">
                          <div class="f-4 fw-600 op-40">
                            Due date
                          </div>
                          <div class="v-center mt-1">
                            <i class="d-block i-icon i-calendar bgc-dark mr-2"></i>
                            <span class="f-4">{{detail.due_date | timezone: timezone:'MM/D/YYYY'}} at {{detail.due_date | timezone: timezone: 'hh:mm A'}}</span>
                          </div>
                        </div>
                        <div class="type ml-5">
                          <div class="f-4 fw-600 op-40">
                            Type
                          </div>
                          <div class="v-center mt-1">
                            <ng-container [ngSwitch]="detail.type">
                              <i class="d-block i-icon i-task bgc-dark mr-2" *ngSwitchCase="'task'"></i>
                              <i class="d-block i-icon i-phone bgc-dark mr-2" *ngSwitchCase="'call'"></i>
                              <i class="d-block i-icon i-lunch bgc-dark mr-2" *ngSwitchCase="'meeting'"></i>
                              <i class="d-block i-icon i-message bgc-dark mr-2" *ngSwitchCase="'email'"></i>
                              <i class="d-block i-icon i-video bgc-dark mr-2" *ngSwitchCase="'material'"></i>
                            </ng-container>
                            <span>{{detail.type}}</span>
                          </div>
                        </div>
                      </div>
                      <div class="related-history-item" *ngIf="groupActions[detail._id] && groupActions[detail._id].length > 1">
                        <app-accordion [showIndicator]="show" [hideIndicator]="hide">
                          <ng-template #show>
                            <div class="">
                              <div class="f-3 fw-600 c-blue mt-1">
                                See details
                              </div>
                            </div>
                          </ng-template>
                          <ng-template #hide>
                            <div class="w-100">
                              <ng-container *ngFor="let detailActivity of groupActions[detail._id]; let i = index;">
                                <div class="d-flex mb-1">
                                  <div class="mr-2 font-weight-bold"># {{groupActions[detail._id].length - i}}</div>
                                  <div class="mr-2 text-capitalize rounded-pill bgc-green-weak text-white px-3">{{detailActivity.content}}</div>
                                  <div class="ml-auto c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                                </div>
                              </ng-container>
                              <div class="f-3 fw-600 c-blue mt-1">
                                Close
                              </div>
                            </div>
                          </ng-template>
                        </app-accordion>
                      </div>
                    </div>
                  </div>

                  <div class="history-detail deals-detail p-3 mt-3" *ngSwitchCase="'deal'">
                    <div class="v-center justify-content-between mb-3">
                      <a class="v-center link-wrapper" [routerLink]="['/deals/' + detail._id]">
                        <div class="history-icon mr-3"><i class="act-icon act-deals"></i></div>
                        <div class="">deal</div>
                      </a>
                      <div class="ml-auto f-3 op-56 mr-span">
                        {{detail.created_at | date :'MMM d, hh:mm a'}}
                      </div>
                      <!-- <div ngbDropdown class="button-more p-1 rounded" placement="bottom-right">
                        <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                          <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                        </a>
                        <div ngbDropdownMenu class="light py-1">
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="excludeContact(detail)"
                          >
                            <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Exclude from deal</span>
                          </button>
                          <button
                            class="v-center border-0 py-1 c-dark dropdown-item"
                            (click)="removeDeal(detail)"
                          >
                            <i class="i-icon i-trash bgc-dark ml-1" aria-hidden="true"></i>
                            <span class="ml-3 f-2 font-weight-bold">Delete deal</span>
                          </button>
                        </div>
                      </div> -->
                    </div>
                    <div class="main-history-item">
                      <div class="f-6 font-weight-bold">
                        <a class="ci-dark td-none" [routerLink]="['/deals/' + detail._id]">{{detail.title}}</a>
                      </div>
                      <div class="v-center mt-3">
                        <div class="stage">
                          <div class="f-4 fw-600 op-40">
                            Stage
                          </div>
                          <ng-container *ngFor="let dealStage of dealsService.stages$ | async">
                            <div class="f-4 mt-1" *ngIf="dealStage._id == detail.deal_stage">
                              {{dealStage.title}}
                            </div>
                          </ng-container>
                        </div>
                        <div class="d-flex c-pointer" ngbDropdown>
                          <div class="contacts ml-5" (click)="loadContacts(detail.contacts)" ngbDropdownToggle>
                            <div class="f-4 fw-600 op-40">
                              Contacts
                            </div>
                            <div class="v-center mt-1">
                              <i class="d-block i-icon i-lunch bgc-dark mr-2"></i>
                              <span class="f-4">{{detail.contacts?.length || 0}}</span>
                            </div>
                          </div>
                          <div ngbDropdownMenu class="contact-list light px-2">
                            <ng-container *ngIf="loadingContact; else showContacts">
                              <div class="list-loading text-center">
                                <div class="loader px-0"></div>
                              </div>
                            </ng-container>
                            <ng-template #showContacts>
                              <ng-container *ngFor="let contact of detailContacts">
                                <a class="v-center py-1 c-pointer link-wrapper" href="{{siteUrl}}/contact/{{contact._id}}" target="_blank">
                                  <div class="form-avatar rounded-circle bg-dark mr-1">{{contact.avatarName}}</div>
                                  <div class="info ml-2">
                                    <div class="f-2 font-weight-bold">{{contact.fullName}}</div>
                                    <div class="f-2">{{contact.email}}</div>
                                  </div>
                                </a>
                              </ng-container>
                            </ng-template>
                          </div>
                        </div>
                        <div class="value ml-5">
                          <div class="f-4 fw-600 op-40">
                            Value
                          </div>
                          <div class="f-4 mt-1">
                            $ {{detail.value}}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
            </ng-container>

            <ng-template #emptyDetails>
              <div class="empty-list">
                <div class="object-icon v-center">
                  <i class="i-icon i-{{tab.id}}s d-block bgc-dark"></i>
                </div>
                <h4 class="font-weight-bold mt-4 mb-3">
                  <ng-container *ngIf="tab.id === 'follow_up'; else anotherEmptyText">
                    <ng-container [ngSwitch]="selectedTimeSort.id">
                      <span *ngSwitchCase="'all'">There are no tasks with this contact yet.</span>
                      <span *ngSwitchCase="'overdue'">There are no overdue tasks.</span>
                      <span *ngSwitchCase="'today'">There are no tasks today.</span>
                      <span *ngSwitchCase="'tomorrow'">There are no tasks tomorrow.</span>
                      <span *ngSwitchCase="'this_week'">There are no tasks for this week.</span>
                      <span *ngSwitchCase="'next_week'">There are no tasks for next week.</span>
                    </ng-container>
                  </ng-container>
                  <ng-template #anotherEmptyText>
                    There are no {{tab.label | lowercase}} with this contact yet.
                  </ng-template>
                </h4>
              </div>
            </ng-template>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
  <div class="updating-status" *ngIf="(contactService.readingDetail$ | async) === STATUS.REQUEST">
    LOADING
  </div>
  <div class="updating-status" *ngIf="(contactService.latestUpdating$ | async) === STATUS.REQUEST">
    RECEIVING LATEST ACTIVITIES
  </div>
</div>

<div class="reload c-pointer" (click)="reloadLatest()">
  <i class="i-icon i-refresh d-block bgc-white" [class.progressing]="(contactService.latestUpdating$ | async) === STATUS.REQUEST"></i>
</div>

<ng-template #appointmentPortalContent>
  <div [class.d-none]="loadingAppointment" class="w-100">
    <app-calendar-event [event]="selectedAppointment" (onClose)="closeOverlay($event)" class="w-100">
    </app-calendar-event>
  </div>
  <div *ngIf="loadingAppointment" class="loading-panel">
    <div class="loader my-0"></div>
    <div class="status-text">Loading Appointment...</div>
  </div>
</ng-template>

<ng-template #groupCallPortalContent>
  <div [class.d-none]="loadingGroupCall" class="w-100">
    <app-call-overlay [call]="selectedGroupCall" (onClose)="closeOverlay($event)" class="w-100">
    </app-call-overlay>
  </div>
  <div *ngIf="loadingGroupCall" class="loading-panel">
    <div class="loader my-0"></div>
    <div class="status-text">Loading Group Call...</div>
  </div>
</ng-template>