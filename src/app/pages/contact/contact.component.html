<div class="page-content">
  <div class="v-center page-header pb-4c">
    <div class="">
      <span>Back to all contacts</span>
    </div>
    <div class="v-center ml-auto">
      <span>Person 1 of 20</span>
    </div>
  </div>
  <div class="contact-panel d-flex">
    <div class="contact-info-panel pr-3">
      <div class="contact-main d-flex">
        <div class="contact-avatar lg font-weight-bold">
          {{contact.avatarName}}
        </div>
        <div class="contact-main-info ml-3">
          <div class="f-20 font-weight-bold">{{contact.fullName}}</div>
          <div class="f-3 op-40">{{contact.last_activity_time | date :'MM/dd/yyyy'}}</div>
        </div>
        <div ngbDropdown class="button-more ml-auto">
          <a class="d-flex c-pointer" ngbDropdownToggle>
            <i class="i-icon i-menu-more bgc-dark" aria-hidden="true"></i>
          </a>
          <div ngbDropdownMenu class="light">
            <button class="v-center border-0 py-2 c-dark dropdown-item">
              <i class="i-icon i-list bgc-dark ml-1" aria-hidden="true"></i>
              <span class="ml-3 f-3 font-weight-bold">Add to campaign</span>
            </button>
            <button class="v-center border-0 py-2 c-dark dropdown-item" (click)="openMergeContactDlg()">
              <i class="i-icon i-contact-merge bgc-dark ml-1" aria-hidden="true"></i>
              <span class="ml-3 f-3 font-weight-bold">Merge</span>
            </button>
            <button class="v-center border-0 py-2 c-dark dropdown-item">
              <i class="i-icon i-share bgc-dark ml-1" aria-hidden="true"></i>
              <span class="ml-3 f-3 font-weight-bold">Share contact</span>
            </button>
            <button class="v-center border-0 py-2 c-dark dropdown-item">
              <i class="i-icon i-trash bgc-red ml-1" aria-hidden="true"></i>
              <span class="ml-3 f-3 font-weight-bold c-red">Delete</span>
            </button>
          </div>
        </div>
      </div>
      <div class="my-3 py-2">
        <app-label-select [value]="contact.label" type="form"></app-label-select>
      </div>
      <div class="v-center justify-content-between mb-3 create-actions">
        <button class="btn border border-primary f-6 font-weight-bold c-blue btn-sm w-50 mr-1 py-2" (click)="openGroupCallDlg()">Create group call</button>
        <button class="btn border border-primary f-6 font-weight-bold c-blue btn-sm w-50 ml-1 py-2" (click)="openAppointmentDlg()">Create appointment</button>
      </div>
      <mat-accordion multi class="general-panels">
        <!-- Begin Contact Detail -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="v-center w-100">
                <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                <span class="f-6 font-weight-bold ml-2">Contact details</span>
                <button class="btn border-0 border-primary f-2 font-weight-bold c-blue ml-auto btn-sm v-center">
                  <i class="i-icon i-edit d-block bgc-blue sm mr-1"></i>
                  <span>Edit</span>
                </button>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="contact-detail">
            <div class="v-center py-1">
              <i class="i-icon i-contact-phone bgc-dark mr-2"></i>
              <span class="f-6">{{contact.cell_phone}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-message bgc-dark mr-2"></i>
              <span class="f-6">{{contact.email}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-contact-location bgc-dark mr-2"></i>
              <span class="f-6">{{contact.fullAddress}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-webpage bgc-dark mr-2"></i>
              <span class="f-6">{{contact.website}}</span>
            </div>
          </div>
        </mat-expansion-panel>
        <!-- End Contact Detail -->

        <!-- Begin Contact Secondary Information -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="v-center w-100">
                <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                <span class="f-6 font-weight-bold ml-2">Secondary contacts</span>
                <button class="btn border-0 border-primary f-2 font-weight-bold c-blue ml-auto btn-sm v-center">
                  <i class="i-icon i-edit d-block bgc-blue sm mr-1"></i>
                  <span>Edit</span>
                </button>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="contact-detail">
            <div class="v-center py-1">
              <i class="i-icon i-contact-phone bgc-dark mr-2"></i>
              <span class="f-6">{{contact.secondary_phone}}</span>
            </div>
            <div class="v-center py-1">
              <i class="i-icon i-message bgc-dark mr-2"></i>
              <span class="f-6">{{contact.secondary_email}}</span>
            </div>
          </div>
          <div class="contact-secondary"></div>
        </mat-expansion-panel>
        <!-- End Contact Secondary Information -->

        <!-- Begin Contact Additional Information -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="v-center w-100">
                <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                <span class="f-6 font-weight-bold ml-2">Additional information</span>
                <button class="btn border-0 border-primary f-2 font-weight-bold c-blue ml-auto btn-sm v-center">
                  <i class="i-icon i-edit d-block bgc-blue sm mr-1"></i>
                  <span>Edit</span>
                </button>
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="contact-additional">
            <div class="v-center py-2">
              <span class="f-6 fw-600 op-40 info-title">Source</span>
              <span class="f-6">{{contact.source}}</span>
            </div>
            <div class="v-center py-2">
              <span class="f-6 fw-600 op-40 info-title">Current Company</span>
              <span class="f-6">{{contact.brokerage}}</span>
            </div>
            <div class="d-flex py-2">
              <span class="f-6 fw-600 op-40 info-title">Tags</span>
              <div class="f-3 tags-wrapper flex-grow-1">
                <app-input-tag [selectedTags]="contact.tags"></app-input-tag>
              </div>
            </div>
          </div>
        </mat-expansion-panel>
        <!-- End Contact Additional Information -->

        <!-- Begin Contact Automation Information -->
        <mat-expansion-panel class="mat-elevation-z" hideToggle expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              <div class="v-center justify-content-between w-100">
                <div class="v-center">
                  <i class="i-icon i-triangle-right bgc-dark sm toggle-icon op-40"></i>
                  <span class="f-6 font-weight-bold ml-2">Automation</span>
                </div>
                <!-- <div class="f-3 fw-600 c-blue c-pointer" (click)="createAutomation()">
                  Create new automation
                </div> -->
              </div>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div class="automation">
            <div class="v-center">
              <app-input-automation></app-input-automation>
              <div class="v-center automation-action ml-2">
                <i class="d-block i-icon i-automation-start bgc-green-weak"></i>
                <i class="d-block i-icon i-automation-cancel bgc-blue ml-2"></i>  
              </div>
            </div>
            <div class="automation-detail mt-3" *ngIf="allDataSource.data?.length">
              <mat-tree [dataSource]="dataSource" [treeControl]="treeControl"
              class="timeline timeline-one-side time-line">
                <mat-tree-node class="mat-tree" [class.first]="node['condition'] && node['condition']['answer'] == true" *matTreeNodeDef="let node" matTreeNodeToggle>
                  <li class="mat-tree-node timeline-block {{ node.status }}">
                    <div class="timeline w-100">
                      <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == true">
                        <img src="../../assets/img/automations/yes.svg">
                        <span class="f-1 font-weight-bold text-center w-100" *ngIf="node['condition']">{{ActionName[node['condition']['case']]}}?</span>
                      </div>
                      <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == false">
                        <img src="../../assets/img/automations/no.svg">
                      </div>
                      <div class="bgc-green-weak line"></div>
                      <div class="v-center c-pointer" #treeNode (click)="easyView(node, treeNode, treeOverlay)">
                        <span class="timeline-step {{ node.action?.type }}">
                          <img [attr.src]="ICONS[node.action?.type]">
                        </span>
                        <div class="timeline-content ml-1">
                          <div class="f-1 font-weight-bold title m-0">
                            {{ ActionName[node.action?.type] }}
                          </div>
                          <div class="f-1 font-weight-bold text-left text-uppercase p-0 badge status {{ node.status }}">
                            {{ node.status }}
                          </div>
                        </div>
                      </div>
                    </div>
                  </li>
                </mat-tree-node>
                <mat-nested-tree-node class="mat-nested-tree" [class.first]="node['condition'] && node['condition']['answer'] == true" *matTreeNodeDef="let node; when: hasChild">
                  <div class="timeline-condition" *ngIf="node['condition'] && node['condition']['case']">
                    <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == true">
                      <img src="../../assets/img/automations/yes.svg">
                      <span class="f-1 font-weight-bold text-center w-100" *ngIf="node['condition']">{{ActionName[node['condition']['case']]}}?</span>
                    </div>
                    <div class="v-center justify-content-between w-100 condition" *ngIf="node['condition'] && node['condition']['answer'] == false">
                      <img src="../../assets/img/automations/no.svg">
                    </div>
                    <div class="bgc-green-weak line"></div>
                  </div>
                  <li>
                    <div class="d-flex mat-tree-node timeline-block c-pointer" #nestedTreeNode (click)="easyView(node, nestedTreeNode, treeOverlay)">
                      <span class="timeline-step {{ node.action?.type }}">
                        <img [attr.src]="ICONS[node.action?.type]">
                      </span>
                      <div class="timeline-content ml-1">
                        <div class="f-1 font-weight-bold title m-0">
                          {{ ActionName[node.action?.type] }}
                        </div>
                        <div class="f-1 font-weight-bold text-left text-uppercase p-0 badge status {{ node.status }}">
                          {{ node.status }}
                        </div>
                      </div>
                    </div>
                    <div class="bgc-green-weak line"></div>
                    <div class="d-flex p-0" [class.timeline-tree-invisible]="
                        !treeControl.isExpanded(node)
                      ">
                      <ng-container matTreeNodeOutlet></ng-container>
                    </div>
                  </li>
                </mat-nested-tree-node>
                <ng-template #treeOverlay let-close="close" let-data>
                  <app-automation-tree-overlay
                      [dataSource]="data.data"
                  >
                  </app-automation-tree-overlay>
                </ng-template>
              </mat-tree>
              <div class="v-center justify-content-center f-6 font-weight-bold c-blue c-pointer mt-3" (click)="showFullAutomation()">
                Show full automation
              </div>
            </div>
          </div>
        </mat-expansion-panel>
        <!-- Begin Contact Automation Information -->
      </mat-accordion>
    </div>
    <div class="contact-action-panel flex-grow-1 position-relative">
      <div class="action-panel position-relative">
        <div class="main-actions">
          <app-slide-tab [tabs]="tabs" [selected]="action" (onChange)="action = $event" type="plain">
          </app-slide-tab>
          <div class="tab-panel">
            <div class="email-panel" *ngIf="action.id === 'send_email'">
              <form #emailForm="ngForm" (ngSubmit)="emailForm.form.valid ? sendEmail() : false">
                <div class="email-box">
                  <div class="v-center justify-content-between receiver pl-3 pr-2 py-1 contacts-wrapper">
                    <div class="v-center w-50">
                      <label class="f-6 op-56 m-0">To:</label>
                      <app-input-contacts
                        [selectedContacts]="emailContacts"
                        class="w-100 ml-2"
                      ></app-input-contacts>
                    </div>
                    <div class="v-center">
                      <div class="f-6 c-blue p-1 c-pointer" (click)="ccFlag = !ccFlag">{{ccFlag ? "Disable Cc" : "Add Cc"}}</div>
                      <div class="f-6 c-blue p-1 c-pointer" (click)="bccFlag = !bccFlag">{{bccFlag ? "Disable Bcc" : "Add Bcc"}}</div>
                    </div>
                  </div>
                  <div class="email-tracking contacts-wrapper" *ngIf="ccFlag || bccFlag">
                    <div class="v-center pl-3 f-2 py-1">
                      <mat-icon class="mr-2">warning</mat-icon>
                      Email tracking is not working if you add cc, bcc.
                    </div>
                    <div class="v-center pl-3 py-2 email-cc" *ngIf="ccFlag">
                      <label class="f-6 text-uppercase op-56 m-0">cc:</label>
                      <app-input-contacts
                        [selectedContacts]="ccContacts"
                        class="w-100 ml-2"
                      ></app-input-contacts>
                    </div>
                    <div class="v-center pl-3 py-2 email-bcc" *ngIf="bccFlag">
                      <label class="f-6 text-uppercase op-56 m-0">bcc:</label>
                      <app-input-contacts
                        [selectedContacts]="bccContacts"
                        class="w-100 ml-2"
                      ></app-input-contacts>
                    </div>
                  </div>
                  <div class="email-title px-3 py-2 position-relative">
                    <input
                      class="w-100"
                      type="text"
                      placeholder="Subject:"
                      name="emailTitle"
                      #emailTitle="ngModel"
                      [(ngModel)]="emailSubject"
                      required
                    >
                    <span
                      class="invalid-error f-3 c-red inline-error" 
                      *ngIf="emailTitle.invalid && (emailTitle.touched || emailTitle.dirty)"
                    >
                      Required!
                    </span>
                  </div>
                  <div class="email-body">
                    <app-html-editor 
                      [(value)]="emailContent" 
                      placeholder="Start typing here..."
                      required="true"
                      hasToken=true
                      >
                    </app-html-editor>
                  </div>
                  <div class="v-center justify-content-between p-3 email-setting">
                    <div class="v-center justify-content-between">
                      <button type="button" class="v-center btn border-primary f-3 font-weight-bold c-blue p-2 mr-2 material-button" (click)="openMaterialsDlg()">
                        <i class="d-block i-icon i-material bgc-blue"></i>
                        <span class="f-3 font-weight-bold c-blue mx-2">Material</span>
                        <i class="d-block i-icon i-plus bgc-blue"></i>
                      </button>
                      <div ngbDropdown class="email-template px-3 c-pointer">
                        <div class="v-center" ngbDropdownToggle>
                          <i class="d-block i-icon i-template bgc-blue"></i>
                          <div class="ml-2">
                            <div class="f-3 font-weight-bold c-blue select-title">
                              Template
                            </div>
                            <div class="f-1 font-weight-bold op-64 c-white select-status" *ngIf="selectedTemplate.subject|| selectedTemplate.content">
                              Selected
                            </div>
                          </div>
                        </div>
                        <div ngbDropdownMenu class="light p-2">
                          <app-input-template
                            [type]="'email'"
                            [placeholder]="'Search templates'"
                            [(template)]="selectedTemplate"
                            (templateChange)="selectTemplate($event)"
                          ></app-input-template>
                        </div>
                      </div>
                      <div class="email-schedule ml-3 c-pointer">
                        <i class="d-block i-icon i-schedule bgc-blue"></i>
                      </div>
                      <div class="email-reminder ml-3 c-pointer">
                        <i class="d-block i-icon i-reminder bgc-blue"></i>
                      </div>
                    </div>
                    <button
                      type="submit"
                      class="btn btn-blue text-white br-default py-1 f-6 font-weight-bold shadow"
                      [class.loading]="emailSending"
                    >
                      Send
                    </button>
                  </div>
                </div>
              </form>
            </div>
            <div class="text-panel" *ngIf="action.id === 'send_text'">
            </div>
            
            <div class="note-panel" *ngIf="action.id === 'note'">
              <form #noteForm="ngForm" (ngSubmit)="noteForm.form.valid ? createNote() : false">
                <div class="note-title px-2 py-2 position-relative">
                  <input
                    class="ml-2 w-100"
                    type="text"
                    name="noteTitle"
                    #noteTitle="ngModel"
                    [(ngModel)]="note.title"
                    placeholder="Title"
                    required
                  >
                  <span
                    class="invalid-error f-3 fw-600 c-red pl-2 inline-error"
                    *ngIf="!note.title && noteForm.submitted"
                  >
                    Required!
                  </span>
                </div>
                <div class="note-content p-3 position-relative">
                  <textarea
                    class="w-100"
                    placeholder="Start typing here..."
                    name="noteContent"
                    #noteContent="ngModel"
                    [(ngModel)]="note.content"
                    rows="7" cols="50"
                    required
                  ></textarea>
                  <span
                    class="invalid-error f-3 fw-600 c-red inline-error"
                    *ngIf="!note.content && noteForm.submitted"
                  >
                    Required!
                  </span>
                  <div class="v-center justify-content-end">
                    <button
                      type="submit"
                      class="btn btn-blue text-white br-default f-6 font-weight-bold"
                      [class.loading]="noteSaving"
                    >
                      Add note
                    </button>
                  </div>
                </div>
              </form>
            </div>

            <div class="task-panel p-4" *ngIf="action.id === 'add_task'">
              <form #taskForm="ngForm" (ngSubmit)="taskForm.form.valid ? createTask() : false">
                <div class="form-group">
                  <label class="mb-0">type of task</label>
                  <div>
                    <app-task-type [(value)]="task.type"></app-task-type>
                  </div>
                </div>
                <div class="form-group">
                  <div class="v-center">
                    <label class="mb-0">subject</label>
                    <span
                      class="invalid-error f-3 fw-600 c-red ml-auto"
                      *ngIf="!task.content && taskForm.submitted"
                    >
                      Required!
                    </span>
                  </div>
                  <input
                    class="form-control"
                    type="text"
                    placeholder="Provide subject"
                    name="taskSubject"
                    #taskSubject="ngModel"
                    [(ngModel)]="task.content"
                    required>
                </div>
                <div class="row task-time">
                  <div class="col-12 col-sm-6">
                    <div class="form-group">
                      <div class="v-center">
                        <label class="mb-0">date</label>
                        <span
                          class="invalid-error f-3 fw-600 c-red ml-auto"
                          *ngIf="!due_date.year && !due_date.month && !due_date.day && taskForm.submitted"
                        >
                          Required!
                        </span>
                      </div>
                      <div class="input-group">
                        <div class="input-group-prepend">
                          <span class="input-group-text bgc-blue">
                            <i class="i-icon i-calendar bgc-white"></i>
                          </span>
                        </div>
                        <div ngbDropdown class="w-100">
                          <input class="form-control datepicker f-3" placeholder="Select date" name="send_date" [(ngModel)]="selectedDateTime" ngbDropdownToggle type="text" required/>
                          <div ngbDropdownMenu class="date-picker">
                            <div class="picker-header v-center justify-content-between mt-2">
                              <div class="f-6 font-weight-bold">Appointment date</div>
                              <div class="i-icon i-close bg-dark" ngbDropdownToggle></div>
                            </div>
                            <hr class="mt-3 mb-1">
                            <div class="f-8 c-blue font-weight-bold text-center mt-3">{{ getDateTime() | date : 'MMMM d yyyy' }}</div>
                            <div class="picker-body v-center justify-content-between">
                              <div classs="date-picker">
                                <ngb-datepicker name="select_date" #dp [(ngModel)]="due_date" [minDate]="minDate" [firstDayOfWeek]="7" ></ngb-datepicker>
                                <div class="action-button mt-2" align="end">
                                  <button class="btn btn-white f-6 font-weight-bold" type="button" ngbDropdownToggle>Cancel</button>
                                  <div class="btn btn-primary f-6 font-weight-bold ml-2" (click)="setDateTime()" ngbDropdownToggle>Set</div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-sm-6">
                    <div class="form-group">
                      <label class="mb-0 d-block">time</label>
                      <select
                        class="form-control f-3"
                        [(ngModel)]="due_time"
                        name="time"
                        #time="ngModel"
                      >
                        <option value="" disabled>Due Time</option>
                        <option *ngFor="let time of times" value="{{ time.id }}">
                          {{ time.text }}
                        </option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="v-center justify-content-between">
                  <div class="v-center">
                    <div class="custom-control custom-checkbox my-auto">
                      <input
                        type="checkbox"
                        class="custom-control-input"
                        id="repeat_tcc"
                        [checked]="task.is_repeat"
                        (change)="task.is_repeat = !task.is_repeat"
                      />
                      <label
                        class="custom-control-label f-3 fw-600 pt-1"
                        for="repeat_tcc"
                        >Set as recurring event</label
                      >
                    </div>
                    <div class="form-group ml-3 mb-0">
                      <select class="form-control c-blue font-weight-bold" [(ngModel)]="task.repeat_duration" name="duration" #duration="ngModel" [disabled]="!task.is_repeat">
                        <option *ngFor="let type of REPEAT_DURATIONS" [value]="type.value">
                          {{type.label}}
                        </option>
                      </select>
                    </div>
                  </div>
                  <button
                    type="submit"
                    class="btn btn-blue text-white br-default f-6 font-weight-bold"
                    [class.loading]="taskSaving"
                  >
                    Create
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
      <div class="history-panel pt-3 pl-3 mt-2">
        <div class="type-headers d-flex">
          <div class="type-item rounded px-2 py-1 f-3 font-weight-bold c-pointer" *ngFor="let type of TYPES"
            [ngClass]="{'border': type.id === activeHistory, 'border-primary': type.id === activeHistory, 'c-blue': type.id === activeHistory}"
            [class.op-40]="type.id !== activeHistory" (click)="activeHistory = type.id">
            {{type.label}}
          </div>
        </div>
        <div class="history-list mt-3 position-relative" *ngIf="mainTimelines && mainTimelines.length">
          <ng-container *ngFor="let activity of mainTimelines">
            <div class="time-line d-flex">
              <div class="history-icon mr-3"><i class="act-icon act-{{activity.type}} {{activity.activity_detail?.type}}" ></i></div>
              <!-- History Item -->
              <div class="history-info">
                <div class="history-header">
                  <span>{{activity.content}}</span>
                  <div class="v-center history-time ml-auto">
                    <span class="f-3 op-56 ml-auto">{{activity.created_at | date :'hh:mm a'}}</span>
                    <div ngbDropdown class="button-more p-1 rounded">
                      <a class="d-flex c-pointer no-carot" ngbDropdownToggle>
                        <i class="i-icon i-menu-more bg-dark" aria-hidden="true"></i>
                      </a>
                      <div ngbDropdownMenu class="light py-1">
                        <button class="v-center border-0 py-1 c-dark dropdown-item">
                          <i class="i-icon i-edit bgc-dark ml-1" aria-hidden="true"></i>
                          <span class="ml-3 f-2 font-weight-bold">Delete</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="history-detail {{activity.type}}-detail">
                  <ng-container [ngSwitch]="activity.type">

                    <!-- BEGIN FOLLOW UP ACTIVITY -->
                    <div *ngSwitchCase="'follow_ups'">
                      <ng-container *ngIf="activity.activity_detail; else removedTaskTemplate">
                        <div class="main-history-item" [class.completed]="activity.content.indexOf('completed') !== -1">
                          <div class="content">
                            {{activity.activity_detail.content}}
                          </div>
                          <div class="time ml-2">
                            {{activity.activity_detail.due_date | date: 'MMM dd, hh:mm a'}}
                          </div>
                        </div>
                      </ng-container>
                      <ng-template #removedTaskTemplate>
                        <div class="d-flex">
                          <mat-icon class="mr-2">warning</mat-icon>
                          <span>Can't see the detail as it is deleted.</span>
                        </div>
                      </ng-template>
                      <div class="related-history-item" *ngIf="groupActions[activity.group_id].length > 1">
                        <app-accordion [detail]="result">
                          <ng-template #result>
                            <ng-container *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                              <div class="d-flex mb-1">
                                <div class="mr-2 font-weight-bold"># {{groupActions[activity.group_id].length - i}}</div>
                                <div class="mr-2 text-capitalize rounded-pill bgc-green-weak text-white px-3">{{detailActivity.content}}</div>
                                <div class="ml-auto c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                              </div>
                            </ng-container>
                          </ng-template>
                        </app-accordion>
                      </div>
                    </div>
                    <!-- END FOLLOW UP ACTIVITY -->

                    <!-- BEGIN NOTE ACTIVITY -->
                    <div *ngSwitchCase="'notes'">
                      <ng-container *ngIf="activity.activity_detail; else removedTaskTemplate">
                        <div class="main-history-item">
                          <div class="title font-weight-bold f-4">
                            {{activity.activity_detail.title || 'No Title Note'}}
                          </div>
                          <app-accordion [detail]="result" *ngIf="activity.activity_detail.content">
                            <ng-template #result>
                              <div>{{activity.activity_detail.content}}</div>  
                            </ng-template>
                          </app-accordion>
                        </div>
                      </ng-container>
                    </div>
                    <!-- END NOTE ACTIVITY -->

                    <!-- BEGIN EMAIL ACTIVITY -->
                    <div *ngSwitchCase="activity.type == 'emails' || activity.type == 'email_trackers' ? activity.type : ''">
                      <ng-container *ngIf="activity.activity_detail; else removedTaskTemplate">
                        <div class="main-history-item">
                          <!-- Single History Template -->
                          <ng-container *ngIf="groupActions[activity.group_id].length === 1; else multiEmailHistory">
                            <div class="summary">
                              <div class="title font-weight-bold">
                                {{details[activity.emails]?.subject}}
                              </div>
                              <div class="c-blue mt-3 f-3 fw-600 c-pointer" (click)="showDetail($event)">See detail</div>
                            </div>
                            <div class="detail">
                              <h5 class="font-weight-bold f-24 mb-3">Details</h5>
                              <div class="mb-2"><span class="font-weight-bold mr-3">Subject:</span>{{details[activity.emails]?.subject}}</div>
                              <div [innerHTML]="details[activity.emails]?.content"></div>
                              <div class="d-flex">
                                <button type="button" class="ml-auto btn btn-primary" (click)="hideDetail($event)">Close</button>
                              </div>
                            </div>
                          </ng-container>
                          <!-- Multi History Template -->
                          <ng-template #multiEmailHistory>
                            <div class="title font-weight-bold">
                              {{details[activity.activity_detail.email]?.subject}}
                            </div>
                            <app-accordion [detail]="result" [hideIndicator]="emptyHideIndicator">
                              <ng-template #emptyHideIndicator>
                                <div></div>
                              </ng-template>
                              <ng-template #result>
                                <div>
                                  <ng-container *ngFor="let detailActivity of groupActions[activity.group_id]; let i = index;">
                                    <div class="d-flex mb-1">
                                      <div class="mr-2 font-weight-bold"># {{groupActions[activity.group_id].length - i}}</div>
                                      <div class="mr-2 text-capitalize rounded-pill bgc-orange-weak text-white px-3">{{detailActivity.content}}</div>
                                      <div class="ml-auto c-trans56">{{detailActivity.created_at | date: 'MMM dd, hh:mm a'}}</div>
                                    </div>
                                  </ng-container>
                                  <app-accordion [detail]="emailDetail" [showIndicator]="showIndicator" [hideIndicator]="hideIndicator">
                                    <ng-template #emailDetail>
                                      <div class="mb-3 f-6">
                                        <span class="font-weight-bold mr-2">Subject:</span>
                                        {{details[activity.activity_detail.email]?.subject}}
                                      </div>
                                      <div class="f-6" [innerHTML]="details[activity.activity_detail.email]?.content">
                                      </div>
                                    </ng-template>
                                    <ng-template #showIndicator>
                                      <div class="c-blue f-6 font-weight-bold m-auto">Expand</div>
                                    </ng-template>
                                    <ng-template #hideIndicator>
                                      <div class="c-blue f-6 font-weight-bold m-auto">Collapse</div>
                                    </ng-template>
                                  </app-accordion>
                                </div>  
                              </ng-template>
                            </app-accordion>
                          </ng-template>
                        </div>
                      </ng-container>
                    </div>
                    <!-- END EMAIL ACTIVITY -->

                    <!-- BEGIN VIDEO ACTIVITY -->
                    <div *ngSwitchCase="activity.type == 'videos' || activity.type == 'video_trackers' ? activity.type : ''">
                      <ng-container *ngIf="activity.activity_detail; else removedTaskTemplate">
                        <div class="main-history-item">
                          <div class="title font-weight-bold">
                            {{activity.activity_detail.subject}}
                          </div>
                          <app-accordion [detail]="result">
                            <ng-template #result>
                              <div>
                                <h5 class="font-weight-bold">Details</h5>
                                <div class="mb-2"><span class="font-weight-bold mr-3">Subject:</span>{{activity.activity_detail.subject}}</div>
                                <div [innerHTML]="activity.activity_detail.content"></div>
                              </div>  
                            </ng-template>
                          </app-accordion>
                        </div>
                      </ng-container>
                      <!-- {{groupActions[activity.group_id] | json}} -->
                    </div>
                    <!-- END VIDEO ACTIVITY -->
                  </ng-container>
                  
                  <!-- {{groupActions[activity.group_id] | json}} -->
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>